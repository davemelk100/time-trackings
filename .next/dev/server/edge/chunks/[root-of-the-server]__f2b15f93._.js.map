{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\n\ninterface Session {\n  role: \"admin\" | \"client\"\n  clientId: string | null\n}\n\nfunction getSession(request: NextRequest): Session | null {\n  const raw = request.cookies.get(\"session\")?.value\n  if (!raw) return null\n  try {\n    return JSON.parse(raw) as Session\n  } catch {\n    return null\n  }\n}\n\nexport function middleware(request: NextRequest) {\n  const { pathname } = request.nextUrl\n  const session = getSession(request)\n\n  // Allow API routes without auth check\n  if (pathname.startsWith(\"/api/\")) {\n    return NextResponse.next()\n  }\n\n  // Allow /login for everyone\n  if (pathname === \"/login\") {\n    if (session) {\n      if (session.role === \"admin\") {\n        return NextResponse.redirect(new URL(\"/\", request.url))\n      }\n      if (session.clientId) {\n        return NextResponse.redirect(new URL(`/client/${session.clientId}`, request.url))\n      }\n    }\n    return NextResponse.next()\n  }\n\n  // Unauthenticated → /login\n  if (!session) {\n    return NextResponse.redirect(new URL(\"/login\", request.url))\n  }\n\n  // Admin gets full access\n  if (session.role === \"admin\") {\n    return NextResponse.next()\n  }\n\n  // Client restrictions\n  if (session.role === \"client\" && session.clientId) {\n    // Block admin-only routes\n    if (pathname === \"/\" || pathname === \"/reports\" || pathname === \"/archives\") {\n      return NextResponse.redirect(new URL(`/client/${session.clientId}`, request.url))\n    }\n\n    // Block access to other clients' pages\n    if (pathname.startsWith(\"/client/\")) {\n      const urlClientId = pathname.split(\"/\")[2]\n      if (urlClientId !== session.clientId) {\n        return NextResponse.redirect(new URL(`/client/${session.clientId}`, request.url))\n      }\n    }\n\n    return NextResponse.next()\n  }\n\n  // Unknown role → login\n  return NextResponse.redirect(new URL(\"/login\", request.url))\n}\n\nexport const config = {\n  matcher: [\n    /*\n     * Match all request paths except:\n     * - _next/static (static files)\n     * - _next/image (image optimization)\n     * - favicon.ico\n     * - public files (images, etc)\n     */\n    \"/((?!_next/static|_next/image|favicon.ico|.*\\\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)\",\n  ],\n}\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;;AAOA,SAAS,WAAW,OAAoB;IACtC,MAAM,MAAM,QAAQ,OAAO,CAAC,GAAG,CAAC,YAAY;IAC5C,IAAI,CAAC,KAAK,OAAO;IACjB,IAAI;QACF,OAAO,KAAK,KAAK,CAAC;IACpB,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,SAAS,WAAW,OAAoB;IAC7C,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IACpC,MAAM,UAAU,WAAW;IAE3B,sCAAsC;IACtC,IAAI,SAAS,UAAU,CAAC,UAAU;QAChC,OAAO,gMAAY,CAAC,IAAI;IAC1B;IAEA,4BAA4B;IAC5B,IAAI,aAAa,UAAU;QACzB,IAAI,SAAS;YACX,IAAI,QAAQ,IAAI,KAAK,SAAS;gBAC5B,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,QAAQ,GAAG;YACvD;YACA,IAAI,QAAQ,QAAQ,EAAE;gBACpB,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,CAAC,QAAQ,EAAE,QAAQ,QAAQ,EAAE,EAAE,QAAQ,GAAG;YACjF;QACF;QACA,OAAO,gMAAY,CAAC,IAAI;IAC1B;IAEA,2BAA2B;IAC3B,IAAI,CAAC,SAAS;QACZ,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;IAC5D;IAEA,yBAAyB;IACzB,IAAI,QAAQ,IAAI,KAAK,SAAS;QAC5B,OAAO,gMAAY,CAAC,IAAI;IAC1B;IAEA,sBAAsB;IACtB,IAAI,QAAQ,IAAI,KAAK,YAAY,QAAQ,QAAQ,EAAE;QACjD,0BAA0B;QAC1B,IAAI,aAAa,OAAO,aAAa,cAAc,aAAa,aAAa;YAC3E,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,CAAC,QAAQ,EAAE,QAAQ,QAAQ,EAAE,EAAE,QAAQ,GAAG;QACjF;QAEA,uCAAuC;QACvC,IAAI,SAAS,UAAU,CAAC,aAAa;YACnC,MAAM,cAAc,SAAS,KAAK,CAAC,IAAI,CAAC,EAAE;YAC1C,IAAI,gBAAgB,QAAQ,QAAQ,EAAE;gBACpC,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,CAAC,QAAQ,EAAE,QAAQ,QAAQ,EAAE,EAAE,QAAQ,GAAG;YACjF;QACF;QAEA,OAAO,gMAAY,CAAC,IAAI;IAC1B;IAEA,uBAAuB;IACvB,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;AAC5D;AAEO,MAAM,SAAS;IACpB,SAAS;QACP;;;;;;KAMC,GACD;KACD;AACH"}}]
}