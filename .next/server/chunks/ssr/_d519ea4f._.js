module.exports=[50152,46893,77192,65733,15618,99464,52495,94645,36969,73866,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(3130),e=a.i(40695),f=a.i(5522),g=a.i(17171),h=a.i(97895);let i=c.forwardRef(({className:a,...c},d)=>(0,b.jsx)("textarea",{className:(0,h.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:d,...c}));i.displayName="Textarea",a.s(["Textarea",()=>i],46893);var j=a.i(88237),k=a.i(7554),l=a.i(70121),m=a.i(50104),n=a.i(92843),o=a.i(25152),p=a.i(96743),q=a.i(22297),r=a.i(92616),s=a.i(72752),t=a=>{var b;let d,e,{present:f,children:g}=a,h=function(a){var b,d;let[e,f]=c.useState(),g=c.useRef({}),h=c.useRef(a),i=c.useRef("none"),[j,k]=(b=a?"mounted":"unmounted",d={mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}},c.useReducer((a,b)=>d[a][b]??a,b));return c.useEffect(()=>{let a=u(g.current);i.current="mounted"===j?a:"none"},[j]),(0,s.useLayoutEffect)(()=>{let b=g.current,c=h.current;if(c!==a){let d=i.current,e=u(b);a?k("MOUNT"):"none"===e||b?.display==="none"?k("UNMOUNT"):c&&d!==e?k("ANIMATION_OUT"):k("UNMOUNT"),h.current=a}},[a,k]),(0,s.useLayoutEffect)(()=>{if(e){let a,b=e.ownerDocument.defaultView??window,c=c=>{let d=u(g.current).includes(c.animationName);if(c.target===e&&d&&(k("ANIMATION_END"),!h.current)){let c=e.style.animationFillMode;e.style.animationFillMode="forwards",a=b.setTimeout(()=>{"forwards"===e.style.animationFillMode&&(e.style.animationFillMode=c)})}},d=a=>{a.target===e&&(i.current=u(g.current))};return e.addEventListener("animationstart",d),e.addEventListener("animationcancel",c),e.addEventListener("animationend",c),()=>{b.clearTimeout(a),e.removeEventListener("animationstart",d),e.removeEventListener("animationcancel",c),e.removeEventListener("animationend",c)}}k("ANIMATION_END")},[e,k]),{isPresent:["mounted","unmountSuspended"].includes(j),ref:c.useCallback(a=>{a&&(g.current=getComputedStyle(a)),f(a)},[])}}(f),i="function"==typeof g?g({present:h.isPresent}):c.Children.only(g),j=(0,l.useComposedRefs)(h.ref,(b=i,(e=(d=Object.getOwnPropertyDescriptor(b.props,"ref")?.get)&&"isReactWarning"in d&&d.isReactWarning)?b.ref:(e=(d=Object.getOwnPropertyDescriptor(b,"ref")?.get)&&"isReactWarning"in d&&d.isReactWarning)?b.props.ref:b.props.ref||b.ref));return"function"==typeof g||h.isPresent?c.cloneElement(i,{ref:j}):null};function u(a){return a?.animationName||"none"}t.displayName="Presence",a.s(["Presence",()=>t],77192);var v=a.i(30553),w=a.i(86228),x=a.i(52081),y=a.i(41852),z=a.i(11011),A="Dialog",[B,C]=(0,m.createContextScope)(A),[D,E]=B(A),F=a=>{let{__scopeDialog:d,children:e,open:f,defaultOpen:g,onOpenChange:h,modal:i=!0}=a,j=c.useRef(null),k=c.useRef(null),[l=!1,m]=(0,o.useControllableState)({prop:f,defaultProp:g,onChange:h});return(0,b.jsx)(D,{scope:d,triggerRef:j,contentRef:k,contentId:(0,n.useId)(),titleId:(0,n.useId)(),descriptionId:(0,n.useId)(),open:l,onOpenChange:m,onOpenToggle:c.useCallback(()=>m(a=>!a),[m]),modal:i,children:e})};F.displayName=A;var G="DialogTrigger";c.forwardRef((a,c)=>{let{__scopeDialog:d,...e}=a,f=E(G,d),g=(0,l.useComposedRefs)(c,f.triggerRef);return(0,b.jsx)(v.Primitive.button,{type:"button","aria-haspopup":"dialog","aria-expanded":f.open,"aria-controls":f.contentId,"data-state":Z(f.open),...e,ref:g,onClick:(0,k.composeEventHandlers)(a.onClick,f.onOpenToggle)})}).displayName=G;var H="DialogPortal",[I,J]=B(H,{forceMount:void 0}),K=a=>{let{__scopeDialog:d,forceMount:e,children:f,container:g}=a,h=E(H,d);return(0,b.jsx)(I,{scope:d,forceMount:e,children:c.Children.map(f,a=>(0,b.jsx)(t,{present:e||h.open,children:(0,b.jsx)(r.Portal,{asChild:!0,container:g,children:a})}))})};K.displayName=H;var L="DialogOverlay",M=c.forwardRef((a,c)=>{let d=J(L,a.__scopeDialog),{forceMount:e=d.forceMount,...f}=a,g=E(L,a.__scopeDialog);return g.modal?(0,b.jsx)(t,{present:e||g.open,children:(0,b.jsx)(N,{...f,ref:c})}):null});M.displayName=L;var N=c.forwardRef((a,c)=>{let{__scopeDialog:d,...e}=a,f=E(L,d);return(0,b.jsx)(x.RemoveScroll,{as:z.Slot,allowPinchZoom:!0,shards:[f.contentRef],children:(0,b.jsx)(v.Primitive.div,{"data-state":Z(f.open),...e,ref:c,style:{pointerEvents:"auto",...e.style}})})}),O="DialogContent",P=c.forwardRef((a,c)=>{let d=J(O,a.__scopeDialog),{forceMount:e=d.forceMount,...f}=a,g=E(O,a.__scopeDialog);return(0,b.jsx)(t,{present:e||g.open,children:g.modal?(0,b.jsx)(Q,{...f,ref:c}):(0,b.jsx)(R,{...f,ref:c})})});P.displayName=O;var Q=c.forwardRef((a,d)=>{let e=E(O,a.__scopeDialog),f=c.useRef(null),g=(0,l.useComposedRefs)(d,e.contentRef,f);return c.useEffect(()=>{let a=f.current;if(a)return(0,y.hideOthers)(a)},[]),(0,b.jsx)(S,{...a,ref:g,trapFocus:e.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:(0,k.composeEventHandlers)(a.onCloseAutoFocus,a=>{a.preventDefault(),e.triggerRef.current?.focus()}),onPointerDownOutside:(0,k.composeEventHandlers)(a.onPointerDownOutside,a=>{let b=a.detail.originalEvent,c=0===b.button&&!0===b.ctrlKey;(2===b.button||c)&&a.preventDefault()}),onFocusOutside:(0,k.composeEventHandlers)(a.onFocusOutside,a=>a.preventDefault())})}),R=c.forwardRef((a,d)=>{let e=E(O,a.__scopeDialog),f=c.useRef(!1),g=c.useRef(!1);return(0,b.jsx)(S,{...a,ref:d,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:b=>{a.onCloseAutoFocus?.(b),b.defaultPrevented||(f.current||e.triggerRef.current?.focus(),b.preventDefault()),f.current=!1,g.current=!1},onInteractOutside:b=>{a.onInteractOutside?.(b),b.defaultPrevented||(f.current=!0,"pointerdown"===b.detail.originalEvent.type&&(g.current=!0));let c=b.target;e.triggerRef.current?.contains(c)&&b.preventDefault(),"focusin"===b.detail.originalEvent.type&&g.current&&b.preventDefault()}})}),S=c.forwardRef((a,d)=>{let{__scopeDialog:e,trapFocus:f,onOpenAutoFocus:g,onCloseAutoFocus:h,...i}=a,j=E(O,e),k=c.useRef(null),m=(0,l.useComposedRefs)(d,k);return(0,w.useFocusGuards)(),(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(q.FocusScope,{asChild:!0,loop:!0,trapped:f,onMountAutoFocus:g,onUnmountAutoFocus:h,children:(0,b.jsx)(p.DismissableLayer,{role:"dialog",id:j.contentId,"aria-describedby":j.descriptionId,"aria-labelledby":j.titleId,"data-state":Z(j.open),...i,ref:m,onDismiss:()=>j.onOpenChange(!1)})}),(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(ab,{titleId:j.titleId}),(0,b.jsx)(ac,{contentRef:k,descriptionId:j.descriptionId})]})]})}),T="DialogTitle",U=c.forwardRef((a,c)=>{let{__scopeDialog:d,...e}=a,f=E(T,d);return(0,b.jsx)(v.Primitive.h2,{id:f.titleId,...e,ref:c})});U.displayName=T;var V="DialogDescription",W=c.forwardRef((a,c)=>{let{__scopeDialog:d,...e}=a,f=E(V,d);return(0,b.jsx)(v.Primitive.p,{id:f.descriptionId,...e,ref:c})});W.displayName=V;var X="DialogClose",Y=c.forwardRef((a,c)=>{let{__scopeDialog:d,...e}=a,f=E(X,d);return(0,b.jsx)(v.Primitive.button,{type:"button",...e,ref:c,onClick:(0,k.composeEventHandlers)(a.onClick,()=>f.onOpenChange(!1))})});function Z(a){return a?"open":"closed"}Y.displayName=X;var $="DialogTitleWarning",[_,aa]=(0,m.createContext)($,{contentName:O,titleName:T,docsSlug:"dialog"}),ab=({titleId:a})=>{let b=aa($),d=`\`${b.contentName}\` requires a \`${b.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${b.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${b.docsSlug}`;return c.useEffect(()=>{a&&(document.getElementById(a)||console.error(d))},[d,a]),null},ac=({contentRef:a,descriptionId:b})=>{let d=aa("DialogDescriptionWarning"),e=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${d.contentName}}.`;return c.useEffect(()=>{let c=a.current?.getAttribute("aria-describedby");b&&c&&(document.getElementById(b)||console.warn(e))},[e,a,b]),null},ad=a.i(33508);let ae=c.forwardRef(({className:a,...c},d)=>(0,b.jsx)(M,{ref:d,className:(0,h.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...c}));ae.displayName=M.displayName;let af=c.forwardRef(({className:a,children:c,...d},e)=>(0,b.jsxs)(K,{children:[(0,b.jsx)(ae,{}),(0,b.jsxs)(P,{ref:e,className:(0,h.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...d,children:[c,(0,b.jsxs)(Y,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,b.jsx)(ad.X,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"sr-only",children:"Close"})]})]})]}));af.displayName=P.displayName;let ag=({className:a,...c})=>(0,b.jsx)("div",{className:(0,h.cn)("flex flex-col space-y-1.5 text-center sm:text-left",a),...c});ag.displayName="DialogHeader";let ah=({className:a,...c})=>(0,b.jsx)("div",{className:(0,h.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...c});ah.displayName="DialogFooter";let ai=c.forwardRef(({className:a,...c},d)=>(0,b.jsx)(U,{ref:d,className:(0,h.cn)("text-lg font-semibold leading-none tracking-tight",a),...c}));ai.displayName=U.displayName;let aj=c.forwardRef(({className:a,...c},d)=>(0,b.jsx)(W,{ref:d,className:(0,h.cn)("text-sm text-muted-foreground",a),...c}));aj.displayName=W.displayName,a.s(["Dialog",()=>F,"DialogContent",()=>af,"DialogDescription",()=>aj,"DialogFooter",()=>ah,"DialogHeader",()=>ag,"DialogTitle",()=>ai],65733);var ak=a.i(87682),al=a.i(40622),am=a.i(78560),an=a.i(21937),ao=a.i(70106);let ap=(0,ao.default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);a.s(["Plus",()=>ap],15618);let aq=(0,ao.default)("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);a.s(["Pencil",()=>aq],99464);let ar=(0,ao.default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]),as=(0,ao.default)("paperclip",[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]]),at=(0,ao.default)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]),au=(0,ao.default)("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);function av(a){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(a)}function aw(a){let[b,c]=a.split(":"),d=parseInt(b,10);return`${0===d?12:d>12?d-12:d}:${c} ${d>=12?"PM":"AM"}`}a.s(["ExternalLink",()=>au],52495);let ax={date:"",startTime:"",endTime:"",tasks:"",notes:"",links:[]};function ay({editMode:a=!1,clientId:h="cygnet",hourlyRate:k=null,flatRate:l=null,refreshKey:m=0,billingPeriodEnd:n=null,onRateChange:o}){let{supabase:p}=(0,an.useAuth)(),[q,r]=(0,c.useState)(!1),[s,t]=(0,c.useState)(""),[u,v]=(0,c.useState)(""),[w,x]=(0,c.useState)([]),[y,z]=(0,c.useState)(!1),[A,B]=(0,c.useState)(null),[C,D]=(0,c.useState)(!1),[E,G]=(0,c.useState)(null),[H,I]=(0,c.useState)(ax),[J,K]=(0,c.useState)(null),[L,M]=(0,c.useState)([]),[N,O]=(0,c.useState)([]),[P,Q]=(0,c.useState)([]),[R,S]=(0,c.useState)(!1),[T,U]=(0,c.useState)(null),[V,W]=(0,c.useState)(null),X=(0,c.useMemo)(()=>{let a=w.map(a=>a.date).filter(Boolean).sort();if(0===a.length)return null;let b=a=>`${String(a.getMonth()+1).padStart(2,"0")}/${String(a.getDate()).padStart(2,"0")}/${a.getFullYear()}`,c=b(new Date(a[0]+"T00:00:00"));return n?`${c} - ${b(new Date(n+"T00:00:00"))}`:`${c} - Present`},[w,n]),Y=(0,c.useMemo)(()=>(function(){let a=[];for(let b=6;b<=23;b++)for(let c=0;c<60;c+=15){let d=String(b).padStart(2,"0"),e=String(c).padStart(2,"0"),f=`${d}:${e}`,g=b>=12?"PM":"AM",h=0===b?12:b>12?b-12:b,i=`${h}:${e} ${g}`;a.push({value:f,label:i})}return a})(),[]);(0,c.useEffect)(()=>{let a=!1;return z(!1),B(null),async function(){try{let b=await (0,am.fetchTimeEntries)(p,h);if(a)return;x(b)}catch(b){a||B(b instanceof Error?b.message:"object"==typeof b&&null!==b&&"message"in b?String(b.message):"Failed to load time entries")}finally{a||z(!0)}}(),()=>{a=!0}},[h,p,m]);let Z=w.reduce((a,b)=>a+b.totalHours,0),$=0===w.length?null:null!=l?l:null!=k?Z*k:null,_=function(a,b){if(!a||!b)return 0;let[c,d]=a.split(":").map(Number),[e,f]=b.split(":").map(Number),g=60*c+d,h=60*e+f;return h<=g&&(h+=1440),Math.round((h-g)/60*100)/100}(H.startTime,H.endTime);async function aa(){if(!H.date||!H.startTime||H.endTime&&_<=0)return;let a=H.endTime?`${aw(H.startTime)} - ${aw(H.endTime)}`:`${aw(H.startTime)} - In Progress`,b=E?.id??crypto.randomUUID();try{for(let a of(S(!0),P))await (0,am.deleteAttachment)(p,a.path);let c=[];for(let a of L){let d=await (0,am.uploadAttachment)(p,a,h,b);c.push(d)}let d=[...N.filter(a=>!P.some(b=>b.path===a.path)),...c],e={date:H.date,startTime:H.startTime,endTime:H.endTime,timeRange:a,totalHours:H.endTime?_:0,tasks:H.tasks,notes:H.notes,attachments:d,links:H.links.filter(a=>a.url.trim())};if(E){let a={...E,...e};x(b=>b.map(b=>b.id===E.id?a:b)),await (0,am.upsertTimeEntry)(p,a,h)}else{let a={id:b,...e};x(b=>[...b,a]),await (0,am.upsertTimeEntry)(p,a,h)}D(!1)}catch(a){B(a instanceof Error?a.message:"Failed to save time entry");try{let a=await (0,am.fetchTimeEntries)(p,h);x(a)}catch{}}finally{S(!1)}}async function ab(a){let b=w.find(b=>b.id===a);x(w.filter(b=>b.id!==a)),K(null);try{b?.attachments?.length&&await (0,am.deleteAllAttachments)(p,b.attachments),await (0,am.deleteTimeEntry)(p,a)}catch(a){B(a instanceof Error?a.message:"Failed to delete time entry"),x(w)}}return y?(0,b.jsxs)("div",{className:"flex flex-col gap-6",children:[A&&(0,b.jsx)(d.Card,{className:"border-destructive",children:(0,b.jsxs)(d.CardContent,{className:"p-4text-destructive",children:[A,(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",className:"ml-2",onClick:()=>B(null),children:"Dismiss"})]})}),w.length>0&&(0,b.jsx)(d.Card,{children:(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsxs)("div",{className:"invoice-print hidden print:flex justify-between items-start",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-0.5",children:[(0,b.jsx)(d.CardTitle,{children:"Invoice Details"}),X&&(0,b.jsx)("span",{className:"text-muted-foreground",children:X})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-1 items-end text-right",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Payable To: "}),(0,b.jsx)("span",{className:"font-medium",children:al.timeTrackingMeta.payableTo})]}),(0,b.jsx)("div",{className:"text-muted-foreground",children:"2680 Diane Marie Ct, Waterford, MI 48329"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Venmo: "}),(0,b.jsx)("span",{className:"font-medium",children:"@MelkonianLLC"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:null!=l?"Flat Rate: ":"Hourly Rate: "}),(0,b.jsx)("span",{className:"font-medium",children:null!=l?av(l):null!=k?av(k):"TBD"})]})]})]}),(0,b.jsxs)("div",{className:"invoice-screen grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-0.5",children:[(0,b.jsx)(d.CardTitle,{children:"Invoice Details"}),X&&(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:X})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-0.5 items-start",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Payable To"}),(0,b.jsx)("span",{className:"font-medium",children:al.timeTrackingMeta.payableTo}),(0,b.jsxs)("span",{className:"text-muted-foreground",children:["2680 Diane Marie Ct",(0,b.jsx)("br",{}),"Waterford, MI 48329"]})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-0.5 items-start",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Venmo"}),(0,b.jsx)("span",{className:"font-medium",children:"@MelkonianLLC"})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-0.5 items-start",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:null!=l?"Flat Rate":"Hourly Rate"}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)("span",{className:"font-medium",children:null!=l?av(l):null!=k?av(k):"TBD"}),o&&(0,b.jsx)("button",{className:"text-muted-foreground hover:text-primary print:hidden",onClick:()=>{t(null!=k?String(k):""),v(null!=l?String(l):""),r(!0)},"aria-label":"Edit rate",children:(0,b.jsx)(aq,{className:"h-3.5 w-3.5"})})]})]})]})]})}),(w.length>0||a)&&(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{className:"flex flex-row items-center justify-between pb-4",children:[(0,b.jsx)("div",{children:(0,b.jsx)(d.CardTitle,{children:"Time Tracking"})}),a&&(0,b.jsxs)(e.Button,{onClick:function(){G(null),I(ax),M([]),O([]),Q([]),D(!0)},size:"sm",children:[(0,b.jsx)(ap,{className:"mr-1.5 h-4 w-4"}),"Add Entry"]})]}),w.length>0&&(0,b.jsx)(d.CardContent,{className:"p-0",children:(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)(j.Table,{children:[(0,b.jsx)(j.TableHeader,{children:(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableHead,{className:"w-[110px]",children:"Date"}),(0,b.jsx)(j.TableHead,{children:"Tasks"}),(0,b.jsx)(j.TableHead,{className:"w-[110px]",children:"Time Range"}),(0,b.jsx)(j.TableHead,{className:"w-[80px] text-right",children:"Hours"}),(0,b.jsx)(j.TableHead,{className:"w-[100px] text-right",children:"Cost"}),a&&(0,b.jsx)(j.TableHead,{className:"w-[100px] text-right",children:"Actions"})]})}),(0,b.jsx)(j.TableBody,{children:w.map(c=>{let d;return(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableCell,{className:"whitespace-nowrap font-medium",children:(d=new Date(c.date+"T00:00:00"),`${String(d.getMonth()+1).padStart(2,"0")}/${String(d.getDate()).padStart(2,"0")}/${d.getFullYear()}`)}),(0,b.jsx)(j.TableCell,{className:"max-w-[220px] text-muted-foreground",children:c.tasks}),(0,b.jsx)(j.TableCell,{className:"whitespace-nowrap",children:c.timeRange}),(0,b.jsx)(j.TableCell,{className:"text-right font-mono",children:c.totalHours.toFixed(2)}),(0,b.jsx)(j.TableCell,{className:"text-right font-monotext-muted-foreground",children:(0,b.jsxs)("span",{className:"inline-flex items-center gap-1.5",children:[null!=l?"—":null!=k?av(c.totalHours*k):"TBD",c.attachments?.length>0&&(0,b.jsx)("button",{type:"button",className:"inline-flex text-muted-foreground hover:text-primary",title:`${c.attachments.length} receipt(s)`,onClick:()=>U(c),children:(0,b.jsx)(as,{className:"h-3.5 w-3.5"})}),c.links?.length>0&&(0,b.jsx)("button",{type:"button",className:"inline-flex text-muted-foreground hover:text-primary",title:`${c.links.length} link(s)`,onClick:()=>W(c),children:(0,b.jsx)(au,{className:"h-3.5 w-3.5"})})]})}),a&&(0,b.jsx)(j.TableCell,{className:"text-right",children:(0,b.jsxs)("div",{className:"flex items-center justify-end gap-1",children:[(0,b.jsx)(e.Button,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>{G(c),I({date:c.date,startTime:c.startTime||"",endTime:c.endTime||"",tasks:c.tasks,notes:c.notes,links:c.links??[]}),M([]),O(c.attachments??[]),Q([]),D(!0)},"aria-label":"Edit entry",children:(0,b.jsx)(aq,{className:"h-3.5 w-3.5"})}),(0,b.jsx)(e.Button,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive hover:text-destructive",onClick:()=>K(c.id),"aria-label":"Delete entry",children:(0,b.jsx)(ar,{className:"h-3.5 w-3.5"})})]})})]},c.id)})}),(0,b.jsx)(j.TableFooter,{children:(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableCell,{colSpan:3,className:"font-semibold",children:"Total"}),(0,b.jsx)(j.TableCell,{className:"text-right font-mono font-semibold",children:Z.toFixed(2)}),(0,b.jsx)(j.TableCell,{className:"text-right font-mono font-semibold text-primary",children:null!=$?av($):"TBD"}),a&&(0,b.jsx)(j.TableCell,{})]})})]})})})]}),(0,b.jsx)(F,{open:C,onOpenChange:D,children:(0,b.jsxs)(af,{className:"sm:max-w-md",children:[(0,b.jsxs)(ag,{children:[(0,b.jsx)(ai,{children:E?"Edit Time Entry":"Add Time Entry"}),(0,b.jsx)(aj,{children:E?"Update the details of this time entry.":"Select start and end times to automatically calculate hours."})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,b.jsx)(g.Label,{htmlFor:"entry-date",children:"Date"}),(0,b.jsx)(f.Input,{id:"entry-date",type:"date",value:H.date,onChange:a=>I({...H,date:a.target.value})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,b.jsx)(g.Label,{children:"Start Time"}),(0,b.jsxs)(ak.Select,{value:H.startTime,onValueChange:a=>I({...H,startTime:a}),children:[(0,b.jsx)(ak.SelectTrigger,{children:(0,b.jsx)(ak.SelectValue,{placeholder:"Select start"})}),(0,b.jsx)(ak.SelectContent,{children:Y.map(a=>(0,b.jsx)(ak.SelectItem,{value:a.value,children:a.label},a.value))})]})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,b.jsx)(g.Label,{children:"End Time"}),(0,b.jsxs)(ak.Select,{value:H.endTime,onValueChange:a=>I({...H,endTime:a}),children:[(0,b.jsx)(ak.SelectTrigger,{children:(0,b.jsx)(ak.SelectValue,{placeholder:"Select end"})}),(0,b.jsx)(ak.SelectContent,{children:Y.map(a=>(0,b.jsx)(ak.SelectItem,{value:a.value,children:a.label},a.value))})]})]})]}),H.startTime&&H.endTime&&(0,b.jsxs)("div",{className:"flex items-center gap-3 rounded-md border border-border bg-muted/50 px-4 py-3",children:[(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Calculated Hours"}),(0,b.jsx)("span",{className:"font-mono font-bold",children:_>0?_.toFixed(2):"Invalid range"})]}),_>0&&null==l&&(0,b.jsxs)("div",{className:"ml-auto flex flex-col text-right",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Estimated Cost"}),(0,b.jsx)("span",{className:"font-mono font-bold text-primary",children:null!=k?av(_*k):"TBD"})]})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,b.jsx)(g.Label,{htmlFor:"entry-tasks",children:"Tasks"}),(0,b.jsx)(i,{id:"entry-tasks",placeholder:"Describe the work performed...",rows:3,value:H.tasks,onChange:a=>I({...H,tasks:a.target.value})})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,b.jsx)(g.Label,{children:"Receipts"}),(0,b.jsx)("input",{type:"file",accept:"image/*,.pdf,application/pdf",multiple:!0,className:"text-sm file:mr-3 file:rounded-md file:border-0 file:bg-primary file:px-3 file:py-1.5 file:text-sm file:font-medium file:text-primary-foreground hover:file:bg-primary/90",onChange:a=>{let b=Array.from(a.target.files??[]).filter(a=>!(a.size>5242880)||(B(`"${a.name}" exceeds 5 MB limit`),!1));M(a=>[...a,...b]),a.target.value=""}}),N.filter(a=>!P.some(b=>b.path===a.path)).map(a=>(0,b.jsxs)("div",{className:"flex items-center gap-2 rounded-md border px-3 py-1.5 text-sm",children:[(0,b.jsx)(as,{className:"h-3.5 w-3.5 shrink-0 text-muted-foreground"}),(0,b.jsx)("span",{className:"truncate",children:a.name}),(0,b.jsxs)("span",{className:"ml-auto text-muted-foreground",children:[(a.size/1024).toFixed(0)," KB"]}),(0,b.jsx)("button",{type:"button",className:"text-destructive hover:text-destructive/80",onClick:()=>Q(b=>[...b,a]),children:(0,b.jsx)(ad.X,{className:"h-3.5 w-3.5"})})]},a.path)),L.map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center gap-2 rounded-md border border-dashed px-3 py-1.5 text-sm",children:[(0,b.jsx)(as,{className:"h-3.5 w-3.5 shrink-0 text-muted-foreground"}),(0,b.jsx)("span",{className:"truncate",children:a.name}),(0,b.jsxs)("span",{className:"ml-auto text-muted-foreground",children:[(a.size/1024).toFixed(0)," KB"]}),(0,b.jsx)("button",{type:"button",className:"text-destructive hover:text-destructive/80",onClick:()=>M(a=>a.filter((a,b)=>b!==c)),children:(0,b.jsx)(ad.X,{className:"h-3.5 w-3.5"})})]},`pending-${c}`))]}),(0,b.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,b.jsx)(g.Label,{children:"Links"}),H.links.map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(f.Input,{placeholder:"Label",value:a.label,onChange:a=>{let b=[...H.links];b[c]={...b[c],label:a.target.value},I({...H,links:b})},className:"w-1/3"}),(0,b.jsx)(f.Input,{placeholder:"https://...",value:a.url,onChange:a=>{let b=[...H.links];b[c]={...b[c],url:a.target.value},I({...H,links:b})},className:"flex-1"}),(0,b.jsx)("button",{type:"button",className:"text-destructive hover:text-destructive/80",onClick:()=>I({...H,links:H.links.filter((a,b)=>b!==c)}),children:(0,b.jsx)(ad.X,{className:"h-3.5 w-3.5"})})]},c)),(0,b.jsxs)(e.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>I({...H,links:[...H.links,{url:"",label:""}]}),children:[(0,b.jsx)(ap,{className:"mr-1.5 h-3.5 w-3.5"})," Add Link"]})]})]}),(0,b.jsxs)(ah,{children:[(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>D(!1),children:"Cancel"}),(0,b.jsx)(e.Button,{onClick:aa,disabled:R||!H.date||!H.startTime||!!H.endTime&&_<=0,children:R?"Uploading...":E?"Save Changes":"Add Entry"})]})]})}),(0,b.jsx)(F,{open:null!==J,onOpenChange:()=>K(null),children:(0,b.jsxs)(af,{className:"sm:max-w-sm",children:[(0,b.jsxs)(ag,{children:[(0,b.jsx)(ai,{children:"Delete Time Entry"}),(0,b.jsx)(aj,{children:"Are you sure you want to delete this time entry? This action cannot be undone."})]}),(0,b.jsxs)(ah,{children:[(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>K(null),children:"Cancel"}),(0,b.jsx)(e.Button,{variant:"destructive",onClick:()=>J&&ab(J),children:"Delete"})]})]})}),(0,b.jsx)(F,{open:null!==T,onOpenChange:()=>U(null),children:(0,b.jsxs)(af,{className:"sm:max-w-lg",children:[(0,b.jsxs)(ag,{children:[(0,b.jsx)(ai,{children:"Receipts"}),(0,b.jsxs)(aj,{children:[T?.attachments?.length??0," receipt(s) attached to this entry."]})]}),(0,b.jsx)("div",{className:"flex flex-col gap-4 max-h-[60vh] overflow-y-auto",children:T?.attachments?.map(a=>{let c=(0,am.getAttachmentUrl)(p,a.path);return(0,b.jsxs)("div",{className:"flex flex-col gap-2",children:[a.name.toLowerCase().endsWith(".pdf")?(0,b.jsx)("iframe",{src:c,title:a.name,className:"w-full rounded-md border h-64"}):(0,b.jsx)("img",{src:c,alt:a.name,className:"w-full rounded-md border object-contain max-h-64"}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("span",{className:"truncate font-medium",children:a.name}),(0,b.jsxs)("span",{className:"text-muted-foreground",children:[(a.size/1024).toFixed(0)," KB"]}),(0,b.jsxs)("a",{href:c,download:a.name,target:"_blank",rel:"noopener noreferrer",className:"ml-auto inline-flex items-center gap-1 text-primary hover:underline",children:[(0,b.jsx)(at,{className:"h-3.5 w-3.5"}),"Download"]})]})]},a.path)})}),(0,b.jsx)(ah,{children:(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>U(null),children:"Close"})})]})}),(0,b.jsx)(F,{open:null!==V,onOpenChange:()=>W(null),children:(0,b.jsxs)(af,{className:"sm:max-w-md",children:[(0,b.jsxs)(ag,{children:[(0,b.jsx)(ai,{children:"Links"}),(0,b.jsxs)(aj,{children:[V?.links?.length??0," link(s)"]})]}),(0,b.jsx)("div",{className:"flex flex-col gap-2",children:V?.links?.map((a,c)=>(0,b.jsxs)("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-sm text-primary hover:underline",children:[(0,b.jsx)(au,{className:"h-3.5 w-3.5 shrink-0"}),a.label||a.url]},c))}),(0,b.jsx)(ah,{children:(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>W(null),children:"Close"})})]})}),o&&(0,b.jsx)(F,{open:q,onOpenChange:r,children:(0,b.jsxs)(af,{className:"sm:max-w-sm",children:[(0,b.jsxs)(ag,{children:[(0,b.jsx)(ai,{children:"Update Rate"}),(0,b.jsx)(aj,{children:"Set an hourly rate or flat rate for this billing period."})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,b.jsx)(g.Label,{htmlFor:"edit-hourly-rate",children:"Hourly Rate"}),(0,b.jsx)(f.Input,{id:"edit-hourly-rate",type:"number",placeholder:"e.g. 75",min:"0",step:"0.01",value:s,onChange:a=>t(a.target.value),disabled:!!u.trim()})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,b.jsx)(g.Label,{htmlFor:"edit-flat-rate",children:"Flat Rate"}),(0,b.jsx)(f.Input,{id:"edit-flat-rate",type:"number",placeholder:"e.g. 5000",min:"0",step:"0.01",value:u,onChange:a=>v(a.target.value),disabled:!!s.trim()})]})]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Set either an hourly rate or a flat rate, not both."})]}),(0,b.jsxs)(ah,{children:[(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>r(!1),children:"Cancel"}),(0,b.jsx)(e.Button,{onClick:()=>{o(s.trim()?Number(s):null,u.trim()?Number(u):null),r(!1)},disabled:!s.trim()&&!u.trim(),children:"Update Rate"})]})]})})]}):(0,b.jsx)(d.Card,{children:(0,b.jsx)(d.CardContent,{className:"p-8 text-center text-muted-foreground",children:"Loading time entries..."})})}function az(a){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(a)}a.s(["TimeTrackingSection",()=>ay],50152);let aA={name:"",category:al.subscriptionCategories[0],billingCycle:"monthly",amount:0,renewalDate:"",notes:"",attachments:[],links:[]};function aB({editMode:a=!1,clientId:h="cygnet",refreshKey:i=0}){let{supabase:k}=(0,an.useAuth)(),[l,m]=(0,c.useState)([]),[n,o]=(0,c.useState)(!1),[p,q]=(0,c.useState)(null),[r,s]=(0,c.useState)(!1),[t,u]=(0,c.useState)(null),[v,w]=(0,c.useState)(aA),[x,y]=(0,c.useState)([]),[z,A]=(0,c.useState)([]),[B,C]=(0,c.useState)([]),[D,E]=(0,c.useState)(!1),[G,H]=(0,c.useState)(null),[I,J]=(0,c.useState)(null);(0,c.useEffect)(()=>{let a=!1;return o(!1),q(null),async function(){try{let b=await (0,am.fetchSubscriptions)(k,h);if(a)return;m(b)}catch(b){a||q(b instanceof Error?b.message:"Failed to load subscriptions")}finally{a||o(!0)}}(),()=>{a=!0}},[h,k,i]);let K=l.reduce((a,b)=>"monthly"===b.billingCycle?a+b.amount:a+b.amount/12,0),L=(0,c.useCallback)(()=>{u(null),w(aA),y([]),A([]),C([]),s(!0)},[]),M=(0,c.useCallback)(a=>{u(a.id),w({name:a.name,category:a.category,billingCycle:a.billingCycle,amount:a.amount,renewalDate:a.renewalDate,notes:a.notes,attachments:a.attachments??[],links:a.links??[]}),y([]),A(a.attachments??[]),C([]),s(!0)},[]),N=(0,c.useCallback)(async()=>{if(!v.name.trim())return;let a=t??crypto.randomUUID();try{for(let a of(E(!0),B))await (0,am.deleteAttachment)(k,a.path);let b=[];for(let c of x){let d=await (0,am.uploadAttachment)(k,c,h,a);b.push(d)}let c=[...z.filter(a=>!B.some(b=>b.path===a.path)),...b];if(t){let a={id:t,...v,attachments:c};m(b=>b.map(b=>b.id===t?a:b)),await (0,am.upsertSubscription)(k,a,h)}else{let b={id:a,...v,attachments:c};m(a=>[...a,b]),await (0,am.upsertSubscription)(k,b,h)}s(!1)}catch(a){q(a instanceof Error?a.message:"Failed to save subscription");try{let a=await (0,am.fetchSubscriptions)(k,h);m(a)}catch{}}finally{E(!1)}},[t,v,h,k,x,z,B]),O=(0,c.useCallback)(async a=>{let b=l.find(b=>b.id===a);m(b=>b.filter(b=>b.id!==a));try{b?.attachments?.length&&await (0,am.deleteAllAttachments)(k,b.attachments),await (0,am.deleteSubscription)(k,a)}catch(a){q(a instanceof Error?a.message:"Failed to delete subscription"),m(l)}},[l]);return n&&(0!==l.length||a)?(0,b.jsxs)("div",{className:"flex flex-col gap-6",children:[p&&(0,b.jsx)(d.Card,{className:"border-destructive",children:(0,b.jsxs)(d.CardContent,{className:"p-4text-destructive",children:[p,(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",className:"ml-2",onClick:()=>q(null),children:"Dismiss"})]})}),(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{className:"flex flex-row items-center justify-between pb-4",children:[(0,b.jsx)("div",{children:(0,b.jsx)(d.CardTitle,{children:"Software Subscriptions"})}),a&&(0,b.jsxs)(e.Button,{size:"sm",onClick:L,className:"gap-1.5",children:[(0,b.jsx)(ap,{className:"h-4 w-4"}),"Add Subscription"]})]}),l.length>0&&(0,b.jsx)(d.CardContent,{className:"p-0",children:(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)(j.Table,{children:[(0,b.jsx)(j.TableHeader,{children:(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableHead,{children:"Name"}),(0,b.jsx)(j.TableHead,{children:"Category"}),(0,b.jsx)(j.TableHead,{className:"w-[110px]",children:"Billing Cycle"}),(0,b.jsx)(j.TableHead,{className:"w-[110px]",children:"Renewal Date"}),(0,b.jsx)(j.TableHead,{children:"Notes"}),(0,b.jsx)(j.TableHead,{className:"w-[100px] text-right",children:"Amount"}),a&&(0,b.jsx)(j.TableHead,{className:"w-[100px] text-right",children:"Actions"})]})}),(0,b.jsx)(j.TableBody,{children:l.map(c=>{let d;return(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableCell,{className:"font-medium",children:c.name}),(0,b.jsx)(j.TableCell,{className:"text-muted-foreground",children:c.category}),(0,b.jsx)(j.TableCell,{className:"capitalize",children:c.billingCycle}),(0,b.jsx)(j.TableCell,{className:"text-muted-foreground",children:c.renewalDate?(d=new Date(c.renewalDate+"T00:00:00"),`${String(d.getMonth()+1).padStart(2,"0")}/${String(d.getDate()).padStart(2,"0")}/${d.getFullYear()}`):"—"}),(0,b.jsx)(j.TableCell,{className:"max-w-[160px] text-muted-foreground",children:c.notes||"—"}),(0,b.jsx)(j.TableCell,{className:"text-right font-mono",children:(0,b.jsxs)("span",{className:"inline-flex items-center gap-1.5",children:[az(c.amount),(0,b.jsxs)("span",{className:"ml-1 text-muted-foreground",children:["/","monthly"===c.billingCycle?"mo":"yr"]}),c.attachments?.length>0&&(0,b.jsx)("button",{type:"button",className:"inline-flex text-muted-foreground hover:text-primary",title:`${c.attachments.length} receipt(s)`,onClick:()=>H(c),children:(0,b.jsx)(as,{className:"h-3.5 w-3.5"})}),c.links?.length>0&&(0,b.jsx)("button",{type:"button",className:"inline-flex text-muted-foreground hover:text-primary",title:`${c.links.length} link(s)`,onClick:()=>J(c),children:(0,b.jsx)(au,{className:"h-3.5 w-3.5"})})]})}),a&&(0,b.jsx)(j.TableCell,{className:"text-right",children:(0,b.jsxs)("div",{className:"flex items-center justify-end gap-1",children:[(0,b.jsxs)(e.Button,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>M(c),children:[(0,b.jsx)(aq,{className:"h-3.5 w-3.5"}),(0,b.jsx)("span",{className:"sr-only",children:"Edit"})]}),(0,b.jsxs)(e.Button,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive hover:text-destructive",onClick:()=>O(c.id),children:[(0,b.jsx)(ar,{className:"h-3.5 w-3.5"}),(0,b.jsx)("span",{className:"sr-only",children:"Delete"})]})]})})]},c.id)})}),(0,b.jsx)(j.TableFooter,{children:(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableCell,{colSpan:5,className:"font-semibold",children:"Total"}),(0,b.jsxs)(j.TableCell,{className:"text-right font-mono font-semibold text-primary",children:[az(12*K),(0,b.jsx)("span",{className:"ml-1 font-normal text-muted-foreground",children:"/yr"})]}),a&&(0,b.jsx)(j.TableCell,{})]})})]})})})]}),(0,b.jsx)(F,{open:r,onOpenChange:s,children:(0,b.jsxs)(af,{className:"sm:max-w-[480px]",children:[(0,b.jsxs)(ag,{children:[(0,b.jsx)(ai,{children:t?"Edit Subscription":"Add Subscription"}),(0,b.jsx)(aj,{children:t?"Update the subscription details below.":"Enter the details for the new subscription."})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-4 py-2",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,b.jsx)(g.Label,{htmlFor:"sub-name",children:"Name"}),(0,b.jsx)(f.Input,{id:"sub-name",value:v.name,onChange:a=>w({...v,name:a.target.value}),placeholder:"e.g. Vercel Pro"})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,b.jsx)(g.Label,{htmlFor:"sub-category",children:"Category"}),(0,b.jsxs)(ak.Select,{value:v.category,onValueChange:a=>w({...v,category:a}),children:[(0,b.jsx)(ak.SelectTrigger,{id:"sub-category",children:(0,b.jsx)(ak.SelectValue,{})}),(0,b.jsx)(ak.SelectContent,{children:al.subscriptionCategories.map(a=>(0,b.jsx)(ak.SelectItem,{value:a,children:a},a))})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,b.jsx)(g.Label,{htmlFor:"sub-cycle",children:"Billing Cycle"}),(0,b.jsxs)(ak.Select,{value:v.billingCycle,onValueChange:a=>w({...v,billingCycle:a}),children:[(0,b.jsx)(ak.SelectTrigger,{id:"sub-cycle",children:(0,b.jsx)(ak.SelectValue,{})}),(0,b.jsxs)(ak.SelectContent,{children:[(0,b.jsx)(ak.SelectItem,{value:"monthly",children:"Monthly"}),(0,b.jsx)(ak.SelectItem,{value:"annual",children:"Annual"})]})]})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,b.jsxs)(g.Label,{htmlFor:"sub-amount",children:["Amount ($/","monthly"===v.billingCycle?"mo":"yr",")"]}),(0,b.jsx)(f.Input,{id:"sub-amount",type:"number",min:"0",step:"0.01",value:v.amount||"",onChange:a=>w({...v,amount:Number.parseFloat(a.target.value)||0}),placeholder:"0.00"})]})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,b.jsx)(g.Label,{htmlFor:"sub-renewal",children:"Renewal Date"}),(0,b.jsx)(f.Input,{id:"sub-renewal",type:"date",value:v.renewalDate,onChange:a=>w({...v,renewalDate:a.target.value})})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,b.jsx)(g.Label,{htmlFor:"sub-notes",children:"Notes"}),(0,b.jsx)(f.Input,{id:"sub-notes",value:v.notes,onChange:a=>w({...v,notes:a.target.value}),placeholder:"Optional notes"})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,b.jsx)(g.Label,{children:"Links"}),v.links.map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(f.Input,{placeholder:"Label",value:a.label,onChange:a=>{let b=[...v.links];b[c]={...b[c],label:a.target.value},w({...v,links:b})},className:"w-1/3"}),(0,b.jsx)(f.Input,{placeholder:"https://...",value:a.url,onChange:a=>{let b=[...v.links];b[c]={...b[c],url:a.target.value},w({...v,links:b})},className:"flex-1"}),(0,b.jsx)("button",{type:"button",className:"text-destructive hover:text-destructive/80",onClick:()=>w({...v,links:v.links.filter((a,b)=>b!==c)}),children:(0,b.jsx)(ad.X,{className:"h-3.5 w-3.5"})})]},c)),(0,b.jsxs)(e.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>w({...v,links:[...v.links,{url:"",label:""}]}),children:[(0,b.jsx)(ap,{className:"mr-1.5 h-3.5 w-3.5"})," Add Link"]})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,b.jsx)(g.Label,{children:"Receipts"}),(0,b.jsx)("input",{type:"file",accept:"image/*,.pdf,application/pdf",multiple:!0,className:"text-sm file:mr-3 file:rounded-md file:border-0 file:bg-primary file:px-3 file:py-1.5 file:text-sm file:font-medium file:text-primary-foreground hover:file:bg-primary/90",onChange:a=>{let b=Array.from(a.target.files??[]).filter(a=>!(a.size>5242880)||(q(`"${a.name}" exceeds 5 MB limit`),!1));y(a=>[...a,...b]),a.target.value=""}}),z.filter(a=>!B.some(b=>b.path===a.path)).map(a=>(0,b.jsxs)("div",{className:"flex items-center gap-2 rounded-md border px-3 py-1.5 text-sm",children:[(0,b.jsx)(as,{className:"h-3.5 w-3.5 shrink-0 text-muted-foreground"}),(0,b.jsx)("span",{className:"truncate",children:a.name}),(0,b.jsxs)("span",{className:"ml-auto text-muted-foreground",children:[(a.size/1024).toFixed(0)," KB"]}),(0,b.jsx)("button",{type:"button",className:"text-destructive hover:text-destructive/80",onClick:()=>C(b=>[...b,a]),children:(0,b.jsx)(ad.X,{className:"h-3.5 w-3.5"})})]},a.path)),x.map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center gap-2 rounded-md border border-dashed px-3 py-1.5 text-sm",children:[(0,b.jsx)(as,{className:"h-3.5 w-3.5 shrink-0 text-muted-foreground"}),(0,b.jsx)("span",{className:"truncate",children:a.name}),(0,b.jsxs)("span",{className:"ml-auto text-muted-foreground",children:[(a.size/1024).toFixed(0)," KB"]}),(0,b.jsx)("button",{type:"button",className:"text-destructive hover:text-destructive/80",onClick:()=>y(a=>a.filter((a,b)=>b!==c)),children:(0,b.jsx)(ad.X,{className:"h-3.5 w-3.5"})})]},`pending-${c}`))]})]}),(0,b.jsxs)(ah,{children:[(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>s(!1),children:"Cancel"}),(0,b.jsx)(e.Button,{onClick:N,disabled:D||!v.name.trim(),children:D?"Uploading...":t?"Save Changes":"Add Subscription"})]})]})}),(0,b.jsx)(F,{open:null!==G,onOpenChange:()=>H(null),children:(0,b.jsxs)(af,{className:"sm:max-w-lg",children:[(0,b.jsxs)(ag,{children:[(0,b.jsx)(ai,{children:"Receipts"}),(0,b.jsxs)(aj,{children:[G?.attachments?.length??0," receipt(s) attached to this subscription."]})]}),(0,b.jsx)("div",{className:"flex flex-col gap-4 max-h-[60vh] overflow-y-auto",children:G?.attachments?.map(a=>{let c=(0,am.getAttachmentUrl)(k,a.path);return(0,b.jsxs)("div",{className:"flex flex-col gap-2",children:[a.name.toLowerCase().endsWith(".pdf")?(0,b.jsx)("iframe",{src:c,title:a.name,className:"w-full rounded-md border h-64"}):(0,b.jsx)("img",{src:c,alt:a.name,className:"w-full rounded-md border object-contain max-h-64"}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("span",{className:"truncate font-medium",children:a.name}),(0,b.jsxs)("span",{className:"text-muted-foreground",children:[(a.size/1024).toFixed(0)," KB"]}),(0,b.jsxs)("a",{href:c,download:a.name,target:"_blank",rel:"noopener noreferrer",className:"ml-auto inline-flex items-center gap-1 text-primary hover:underline",children:[(0,b.jsx)(at,{className:"h-3.5 w-3.5"}),"Download"]})]})]},a.path)})}),(0,b.jsx)(ah,{children:(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>H(null),children:"Close"})})]})}),(0,b.jsx)(F,{open:null!==I,onOpenChange:()=>J(null),children:(0,b.jsxs)(af,{className:"sm:max-w-md",children:[(0,b.jsxs)(ag,{children:[(0,b.jsx)(ai,{children:"Links"}),(0,b.jsxs)(aj,{children:[I?.links?.length??0," link(s)"]})]}),(0,b.jsx)("div",{className:"flex flex-col gap-2",children:I?.links?.map((a,c)=>(0,b.jsxs)("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-sm text-primary hover:underline",children:[(0,b.jsx)(au,{className:"h-3.5 w-3.5 shrink-0"}),a.label||a.url]},c))}),(0,b.jsx)(ah,{children:(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>J(null),children:"Close"})})]})})]}):null}function aC(a){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(a)}function aD(){return new Date().toISOString().slice(0,10)}a.s(["SubscriptionsSection",()=>aB],94645);let aE={description:"",amount:0,date:aD(),notes:"",links:[]};function aF({editMode:a=!1,clientId:h="cygnet",hourlyRate:i=null,flatRate:k=null,onPayablesChange:l}){let{supabase:m}=(0,an.useAuth)(),[n,o]=(0,c.useState)([]),[p,q]=(0,c.useState)(!1),[r,s]=(0,c.useState)(null),[t,u]=(0,c.useState)(!1),[v,w]=(0,c.useState)(null),[x,y]=(0,c.useState)(aE),[z,A]=(0,c.useState)(!1),[B,C]=(0,c.useState)([]),[D,E]=(0,c.useState)([]),[G,H]=(0,c.useState)([]),[I,J]=(0,c.useState)(null),[K,L]=(0,c.useState)(null),[M,N]=(0,c.useState)(0);(0,c.useEffect)(()=>{let a=!1;return q(!1),s(null),async function(){try{let b="nextier"===h,[c,d]=await Promise.all([(0,am.fetchPayables)(m,h),b?Promise.resolve([]):(0,am.fetchTimeEntries)(m,h)]);if(a)return;o(c);let e=d.reduce((a,b)=>a+b.totalHours,0),f=null!=k?k:null!=i?e*i:0;N(Math.round(.1*f*100)/100)}catch(b){a||s(b instanceof Error?b.message:"Failed to load payables")}finally{a||q(!0)}}(),()=>{a=!0}},[h,m,i,k]);let O=n.reduce((a,b)=>a+b.amount,0),P=(0,c.useCallback)(()=>{w(null),y({...aE,date:aD(),amount:M,description:M>0?"10% of time entries":"",links:[]}),C([]),E([]),H([]),u(!0)},[M]),Q=(0,c.useCallback)(a=>{w(a.id),y({description:a.description,amount:a.amount,date:a.date,notes:a.notes,links:a.links??[]}),C([]),E(a.attachments??[]),H([]),u(!0)},[]),R=(0,c.useCallback)(async()=>{if(!x.description.trim())return;let a=v??crypto.randomUUID();try{for(let a of(A(!0),G))await (0,am.deleteAttachment)(m,a.path);let b=[];for(let c of B){let d=await (0,am.uploadAttachment)(m,c,h,a);b.push(d)}let c=[...D.filter(a=>!G.some(b=>b.path===a.path)),...b];if(v){let a=n.find(a=>a.id===v),b={id:v,description:x.description,amount:x.amount,date:x.date,paid:a?.paid??!1,paidDate:a?.paidDate??"",notes:x.notes,attachments:c,links:x.links};o(a=>a.map(a=>a.id===v?b:a)),await (0,am.upsertPayable)(m,b,h),"nextier"!==h&&a&&await (0,am.updateNextierMirror)(m,a.description,a.amount,a.date,{description:b.description,amount:b.amount,date:b.date,notes:b.notes,attachments:c,links:x.links})}else{let b={id:a,description:x.description,amount:x.amount,date:x.date,paid:!1,paidDate:"",notes:x.notes,attachments:c,links:x.links};if(o(a=>[b,...a]),await (0,am.upsertPayable)(m,b,h),"nextier"!==h){let a={id:crypto.randomUUID(),description:x.description,amount:x.amount,date:x.date,paid:!0,paidDate:aD(),notes:x.notes,attachments:c,links:x.links};await (0,am.upsertPayable)(m,a,"nextier")}}u(!1),l?.()}catch(a){s(a instanceof Error?a.message:"Failed to save payable");try{let a=await (0,am.fetchPayables)(m,h);o(a)}catch{}}finally{A(!1)}},[v,x,h,m,n,B,D,G]),S=(0,c.useCallback)(async a=>{let b=n.find(b=>b.id===a);o(b=>b.filter(b=>b.id!==a));try{b?.attachments?.length&&await (0,am.deleteAllAttachments)(m,b.attachments),await (0,am.deletePayable)(m,a),"nextier"!==h&&b&&await (0,am.deletePayableByMatch)(m,"nextier",b.description,b.amount,b.date),l?.()}catch(a){s(a instanceof Error?a.message:"Failed to delete payable"),o(n)}},[n,m]);return p&&(0!==n.length||a||"nextier"===h)?(0,b.jsxs)("div",{className:"flex flex-col gap-6",children:[r&&(0,b.jsx)(d.Card,{className:"border-destructive",children:(0,b.jsxs)(d.CardContent,{className:"p-4 text-destructive",children:[r,(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",className:"ml-2",onClick:()=>s(null),children:"Dismiss"})]})}),(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{className:"flex flex-row items-center justify-between pb-4",children:[(0,b.jsx)("div",{children:(0,b.jsx)(d.CardTitle,{children:"nextier"===h?"Nextier Proceeds":"Payables"})}),a&&"nextier"!==h&&(0,b.jsxs)(e.Button,{size:"sm",onClick:P,className:"gap-1.5",children:[(0,b.jsx)(ap,{className:"h-4 w-4"}),"Add Payable"]})]}),n.length>0&&(0,b.jsx)(d.CardContent,{className:"p-0",children:(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)(j.Table,{children:[(0,b.jsx)(j.TableHeader,{children:(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableHead,{className:"w-[110px]",children:"Date"}),(0,b.jsx)(j.TableHead,{children:"Description"}),(0,b.jsx)(j.TableHead,{children:"Notes"}),(0,b.jsx)(j.TableHead,{className:"w-[100px] text-right",children:"Amount"}),a&&"nextier"!==h&&(0,b.jsx)(j.TableHead,{className:"w-[100px] text-right",children:"Actions"})]})}),(0,b.jsx)(j.TableBody,{children:n.map(c=>{let d;return(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableCell,{className:"text-muted-foreground",children:c.date?(d=new Date(c.date+"T00:00:00"),`${String(d.getMonth()+1).padStart(2,"0")}/${String(d.getDate()).padStart(2,"0")}/${d.getFullYear()}`):"—"}),(0,b.jsx)(j.TableCell,{className:"font-medium",children:c.description}),(0,b.jsx)(j.TableCell,{className:"max-w-[160px] text-muted-foreground",children:c.notes||"—"}),(0,b.jsx)(j.TableCell,{className:"text-right font-mono",children:(0,b.jsxs)("span",{className:"inline-flex items-center gap-1.5",children:[aC(c.amount),c.attachments?.length>0&&(0,b.jsx)("button",{type:"button",className:"inline-flex text-muted-foreground hover:text-primary",title:`${c.attachments.length} file(s)`,onClick:()=>J(c),children:(0,b.jsx)(as,{className:"h-3.5 w-3.5"})}),c.links?.length>0&&(0,b.jsx)("button",{type:"button",className:"inline-flex text-muted-foreground hover:text-primary",title:`${c.links.length} link(s)`,onClick:()=>L(c),children:(0,b.jsx)(au,{className:"h-3.5 w-3.5"})})]})}),a&&"nextier"!==h&&(0,b.jsx)(j.TableCell,{className:"text-right",children:(0,b.jsxs)("div",{className:"flex items-center justify-end gap-1",children:[(0,b.jsxs)(e.Button,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>Q(c),children:[(0,b.jsx)(aq,{className:"h-3.5 w-3.5"}),(0,b.jsx)("span",{className:"sr-only",children:"Edit"})]}),(0,b.jsxs)(e.Button,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive hover:text-destructive",onClick:()=>S(c.id),children:[(0,b.jsx)(ar,{className:"h-3.5 w-3.5"}),(0,b.jsx)("span",{className:"sr-only",children:"Delete"})]})]})})]},c.id)})}),(0,b.jsx)(j.TableFooter,{children:(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableCell,{colSpan:3,className:"font-semibold",children:"Total"}),(0,b.jsx)(j.TableCell,{className:"text-right font-mono font-semibold text-primary",children:aC(O)}),a&&"nextier"!==h&&(0,b.jsx)(j.TableCell,{})]})})]})})})]}),(0,b.jsx)(F,{open:null!==I,onOpenChange:()=>J(null),children:(0,b.jsxs)(af,{className:"sm:max-w-lg",children:[(0,b.jsxs)(ag,{children:[(0,b.jsx)(ai,{children:"Attachments"}),(0,b.jsxs)(aj,{children:[I?.attachments?.length??0," file(s) attached to this payable."]})]}),(0,b.jsx)("div",{className:"flex flex-col gap-4 max-h-[60vh] overflow-y-auto",children:I?.attachments?.map(a=>{let c=(0,am.getAttachmentUrl)(m,a.path);return(0,b.jsxs)("div",{className:"flex flex-col gap-2",children:[a.name.toLowerCase().endsWith(".pdf")?(0,b.jsx)("iframe",{src:c,title:a.name,className:"w-full rounded-md border h-64"}):(0,b.jsx)("img",{src:c,alt:a.name,className:"w-full rounded-md border object-contain max-h-64"}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("span",{className:"truncate font-medium",children:a.name}),(0,b.jsxs)("span",{className:"text-muted-foreground",children:[(a.size/1024).toFixed(0)," KB"]}),(0,b.jsxs)("a",{href:c,download:a.name,target:"_blank",rel:"noopener noreferrer",className:"ml-auto inline-flex items-center gap-1 text-primary hover:underline",children:[(0,b.jsx)(at,{className:"h-3.5 w-3.5"}),"Download"]})]})]},a.path)})}),(0,b.jsx)(ah,{children:(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>J(null),children:"Close"})})]})}),(0,b.jsx)(F,{open:null!==K,onOpenChange:()=>L(null),children:(0,b.jsxs)(af,{className:"sm:max-w-md",children:[(0,b.jsxs)(ag,{children:[(0,b.jsx)(ai,{children:"Links"}),(0,b.jsxs)(aj,{children:[K?.links?.length??0," link(s)"]})]}),(0,b.jsx)("div",{className:"flex flex-col gap-2",children:K?.links?.map((a,c)=>(0,b.jsxs)("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-sm text-primary hover:underline",children:[(0,b.jsx)(au,{className:"h-3.5 w-3.5 shrink-0"}),a.label||a.url]},c))}),(0,b.jsx)(ah,{children:(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>L(null),children:"Close"})})]})}),(0,b.jsx)(F,{open:t,onOpenChange:u,children:(0,b.jsxs)(af,{className:"sm:max-w-[480px]",children:[(0,b.jsxs)(ag,{children:[(0,b.jsx)(ai,{children:v?"Edit Payable":"Add Payable"}),(0,b.jsx)(aj,{children:v?"Update the payable details below.":"Enter the details for the new payable."})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-4 py-2",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,b.jsx)(g.Label,{htmlFor:"pay-desc",children:"Description"}),(0,b.jsx)(f.Input,{id:"pay-desc",value:x.description,onChange:a=>y({...x,description:a.target.value}),placeholder:"e.g. Website development - Phase 1"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,b.jsx)(g.Label,{htmlFor:"pay-amount",children:"Amount ($)"}),(0,b.jsx)(f.Input,{id:"pay-amount",type:"number",min:"0",step:"0.01",value:x.amount||"",onChange:a=>y({...x,amount:Number.parseFloat(a.target.value)||0}),placeholder:"0.00"})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,b.jsx)(g.Label,{htmlFor:"pay-date",children:"Date"}),(0,b.jsx)(f.Input,{id:"pay-date",type:"date",value:x.date,onChange:a=>y({...x,date:a.target.value})})]})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,b.jsx)(g.Label,{htmlFor:"pay-notes",children:"Notes"}),(0,b.jsx)(f.Input,{id:"pay-notes",value:x.notes,onChange:a=>y({...x,notes:a.target.value}),placeholder:"Optional notes"})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,b.jsx)(g.Label,{children:"Links"}),x.links.map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(f.Input,{placeholder:"Label",value:a.label,onChange:a=>{let b=[...x.links];b[c]={...b[c],label:a.target.value},y({...x,links:b})},className:"w-1/3"}),(0,b.jsx)(f.Input,{placeholder:"https://...",value:a.url,onChange:a=>{let b=[...x.links];b[c]={...b[c],url:a.target.value},y({...x,links:b})},className:"flex-1"}),(0,b.jsx)("button",{type:"button",className:"text-destructive hover:text-destructive/80",onClick:()=>y({...x,links:x.links.filter((a,b)=>b!==c)}),children:(0,b.jsx)(ad.X,{className:"h-3.5 w-3.5"})})]},c)),(0,b.jsxs)(e.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>y({...x,links:[...x.links,{url:"",label:""}]}),children:[(0,b.jsx)(ap,{className:"mr-1.5 h-3.5 w-3.5"})," Add Link"]})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,b.jsx)(g.Label,{children:"Attachments"}),(0,b.jsx)("input",{type:"file",accept:"image/*,.pdf,application/pdf",multiple:!0,className:"text-sm file:mr-3 file:rounded-md file:border-0 file:bg-primary file:px-3 file:py-1.5 file:text-sm file:font-medium file:text-primary-foreground hover:file:bg-primary/90",onChange:a=>{let b=Array.from(a.target.files??[]).filter(a=>!(a.size>5242880)||(s(`"${a.name}" exceeds 5 MB limit`),!1));C(a=>[...a,...b]),a.target.value=""}}),D.filter(a=>!G.some(b=>b.path===a.path)).map(a=>(0,b.jsxs)("div",{className:"flex items-center gap-2 rounded-md border px-3 py-1.5 text-sm",children:[(0,b.jsx)(as,{className:"h-3.5 w-3.5 shrink-0 text-muted-foreground"}),(0,b.jsx)("span",{className:"truncate",children:a.name}),(0,b.jsxs)("span",{className:"ml-auto text-muted-foreground",children:[(a.size/1024).toFixed(0)," KB"]}),(0,b.jsx)("button",{type:"button",className:"text-destructive hover:text-destructive/80",onClick:()=>H(b=>[...b,a]),children:(0,b.jsx)(ad.X,{className:"h-3.5 w-3.5"})})]},a.path)),B.map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center gap-2 rounded-md border border-dashed px-3 py-1.5 text-sm",children:[(0,b.jsx)(as,{className:"h-3.5 w-3.5 shrink-0 text-muted-foreground"}),(0,b.jsx)("span",{className:"truncate",children:a.name}),(0,b.jsxs)("span",{className:"ml-auto text-muted-foreground",children:[(a.size/1024).toFixed(0)," KB"]}),(0,b.jsx)("button",{type:"button",className:"text-destructive hover:text-destructive/80",onClick:()=>C(a=>a.filter((a,b)=>b!==c)),children:(0,b.jsx)(ad.X,{className:"h-3.5 w-3.5"})})]},`pending-${c}`))]})]}),(0,b.jsxs)(ah,{children:[(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>u(!1),children:"Cancel"}),(0,b.jsx)(e.Button,{onClick:R,disabled:z||!x.description.trim(),children:z?"Saving...":v?"Save Changes":"Add Payable"})]})]})})]}):null}function aG(a){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(a)}function aH({clientId:a="cygnet",hourlyRate:e=null,flatRate:f=null,refreshKey:g=0,hidePayables:h=!1}){let{supabase:i}=(0,an.useAuth)(),[j,k]=(0,c.useState)(0),[l,m]=(0,c.useState)(0),[n,o]=(0,c.useState)(0),[p,q]=(0,c.useState)(!1);if((0,c.useEffect)(()=>{let b=!1;return q(!1),async function(){try{let[c,d,g]=await Promise.all([(0,am.fetchTimeEntries)(i,a),(0,am.fetchSubscriptions)(i,a),(0,am.fetchPayables)(i,a)]);if(b)return;let h=0===c.length&&0===d.length&&0===g.length,j=c.reduce((a,b)=>a+b.totalHours,0);k(h?null:null!=f?f:null!=e?j*e:null);let l=d.reduce((a,b)=>"monthly"===b.billingCycle?a+b.amount:a+b.amount/12,0);m(l);let n=g.reduce((a,b)=>a+b.amount,0);o(n)}catch{}finally{b||q(!0)}}(),()=>{b=!0}},[a,i,g]),!p||!(null!==j||l>0||n>0))return null;let r=12*l,s=h?0:n,t=null!=j?j+r:null,u="nextier"===a?s:null!=t?t-s:null;return(0,b.jsxs)(d.Card,{className:"ml-auto sm:max-w-[50%]",children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsx)(d.CardTitle,{children:"Grand Total"})}),(0,b.jsx)(d.CardContent,{children:(0,b.jsx)("div",{className:"flex justify-end",children:(0,b.jsxs)("div",{className:"flex flex-col items-end",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-0.5 items-end text-muted-foreground",children:[(null==j||j>0)&&(0,b.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,b.jsx)("span",{children:"Time Tracking"}),(0,b.jsx)("span",{className:"font-mono",children:null!=j?aG(j):"TBD"})]}),r>0&&(0,b.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,b.jsx)("span",{children:"Subscriptions"}),(0,b.jsx)("span",{className:"font-mono",children:aG(r)})]}),!h&&n>0&&(0,b.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,b.jsx)("span",{children:"nextier"===a?"Proceeds":"Payables"}),(0,b.jsxs)("span",{className:"font-mono",children:["nextier"===a?"":"−",aG(n)]})]})]}),(0,b.jsx)("div",{className:"mt-1 border-t border-border pt-1 w-full text-right",children:(0,b.jsx)("span",{className:"font-mono font-bold text-primary",children:null!=u?aG(u):"TBD"})})]})})})]})}a.s(["PayablesSection",()=>aF],36969),a.s(["GrandTotalSection",()=>aH],73866)},27999,a=>{"use strict";let b=(0,a.i(70106).default)("calendar-check",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]);a.s(["CalendarCheck",()=>b],27999)},82659,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(3130),e=a.i(40695),f=a.i(5522),g=a.i(17171),h=a.i(65733),i=a.i(88237),j=a.i(99464),k=a.i(52495),l=a.i(78560),m=a.i(21937);function n(a){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(a)}function o({invoice:a,onInvoiceUpdate:o}){let{supabase:p}=(0,m.useAuth)(),[q,r]=(0,c.useState)([]),[s,t]=(0,c.useState)([]),[u,v]=(0,c.useState)([]),[w,x]=(0,c.useState)(!1),[y,z]=(0,c.useState)(!1),[A,B]=(0,c.useState)([]),[C,D]=(0,c.useState)(!1),[E,F]=(0,c.useState)(""),[G,H]=(0,c.useState)(""),[I,J]=(0,c.useState)(!1);if((0,c.useEffect)(()=>{let b=!1;return async function(){try{let[c,d,e]=await Promise.all([(0,l.fetchTimeEntriesByInvoice)(p,a.id),(0,l.fetchSubscriptionsByInvoice)(p,a.id),(0,l.fetchPayablesByInvoice)(p,a.id)]);if(b)return;r(c),t(d),v(e)}catch{}finally{b||x(!0)}}(),()=>{b=!0}},[a.id,p]),!w)return(0,b.jsx)(d.Card,{children:(0,b.jsx)(d.CardContent,{className:"p-8 text-center text-muted-foreground",children:"Loading archived invoice..."})});let K=q.reduce((a,b)=>a+b.totalHours,0);function L(a){let b=new Date(a+"T00:00:00");return`${String(b.getMonth()+1).padStart(2,"0")}/${String(b.getDate()).padStart(2,"0")}/${b.getFullYear()}`}let M=a.periodStart&&a.periodEnd?`${L(a.periodStart)} - ${L(a.periodEnd)}`:"N/A";return(0,b.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsx)(d.CardTitle,{children:a.invoiceNumber})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4 sm:grid-cols-5 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Period"}),(0,b.jsx)("p",{className:"font-medium",children:M})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Hourly Rate"}),(0,b.jsx)("p",{className:"font-mono font-medium",children:K>0?`${n(a.totalTime/K)}/hr`:"—"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Time"}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)("p",{className:"font-mono font-medium",children:n(a.totalTime)}),o&&(0,b.jsx)("button",{className:"text-muted-foreground hover:text-primary",onClick:()=>{F(""),H(""),z(!0)},"aria-label":"Edit rate",children:(0,b.jsx)(j.Pencil,{className:"h-3.5 w-3.5"})})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Subscriptions"}),(0,b.jsx)("p",{className:"font-mono font-medium",children:n(a.totalSubscriptions)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Payables"}),(0,b.jsx)("p",{className:"font-mono font-medium",children:n(a.totalPayables)})]})]}),a.notes&&(0,b.jsx)("p",{className:"mt-3 text-sm text-muted-foreground",children:a.notes})]})]}),q.length>0&&(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsx)(d.CardTitle,{children:"Time Tracking"})}),(0,b.jsx)(d.CardContent,{className:"p-0",children:(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)(i.Table,{children:[(0,b.jsx)(i.TableHeader,{children:(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableHead,{className:"w-[110px]",children:"Date"}),(0,b.jsx)(i.TableHead,{children:"Tasks"}),(0,b.jsx)(i.TableHead,{children:"Notes"}),(0,b.jsx)(i.TableHead,{children:"Time Range"}),(0,b.jsx)(i.TableHead,{className:"w-[80px] text-right",children:"Hours"})]})}),(0,b.jsx)(i.TableBody,{children:q.map(a=>(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableCell,{className:"whitespace-nowrap font-medium",children:L(a.date)}),(0,b.jsx)(i.TableCell,{className:"max-w-[220px] text-muted-foreground",children:a.tasks}),(0,b.jsx)(i.TableCell,{className:"max-w-[160px] text-muted-foreground",children:a.notes||"—"}),(0,b.jsx)(i.TableCell,{className:"whitespace-nowrap",children:a.timeRange}),(0,b.jsx)(i.TableCell,{className:"text-right font-mono",children:(0,b.jsxs)("span",{className:"inline-flex items-center gap-1",children:[a.totalHours.toFixed(2),a.links&&a.links.length>0&&(0,b.jsx)("button",{className:"text-muted-foreground hover:text-primary",onClick:()=>{B(a.links),D(!0)},"aria-label":"View links",children:(0,b.jsx)(k.ExternalLink,{className:"h-3.5 w-3.5"})})]})})]},a.id))}),(0,b.jsx)(i.TableFooter,{children:(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableCell,{colSpan:4,className:"font-semibold",children:"Total"}),(0,b.jsx)(i.TableCell,{className:"text-right font-mono font-semibold",children:q.reduce((a,b)=>a+b.totalHours,0).toFixed(2)})]})})]})})})]}),s.length>0&&(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsx)(d.CardTitle,{children:"Software Subscriptions"})}),(0,b.jsx)(d.CardContent,{className:"p-0",children:(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)(i.Table,{children:[(0,b.jsx)(i.TableHeader,{children:(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableHead,{children:"Name"}),(0,b.jsx)(i.TableHead,{children:"Category"}),(0,b.jsx)(i.TableHead,{className:"w-[110px]",children:"Billing Cycle"}),(0,b.jsx)(i.TableHead,{className:"w-[110px]",children:"Renewal Date"}),(0,b.jsx)(i.TableHead,{children:"Notes"}),(0,b.jsx)(i.TableHead,{className:"w-[100px] text-right",children:"Amount"})]})}),(0,b.jsx)(i.TableBody,{children:s.map(a=>(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableCell,{className:"font-medium",children:a.name}),(0,b.jsx)(i.TableCell,{className:"text-muted-foreground",children:a.category}),(0,b.jsx)(i.TableCell,{className:"capitalize",children:a.billingCycle}),(0,b.jsx)(i.TableCell,{className:"text-muted-foreground",children:a.renewalDate?L(a.renewalDate):"—"}),(0,b.jsx)(i.TableCell,{className:"max-w-[160px] text-muted-foreground",children:a.notes||"—"}),(0,b.jsx)(i.TableCell,{className:"text-right font-mono",children:(0,b.jsxs)("span",{className:"inline-flex items-center gap-1",children:[n(a.amount),(0,b.jsxs)("span",{className:"text-muted-foreground",children:["/","monthly"===a.billingCycle?"mo":"yr"]}),a.links&&a.links.length>0&&(0,b.jsx)("button",{className:"text-muted-foreground hover:text-primary",onClick:()=>{B(a.links),D(!0)},"aria-label":"View links",children:(0,b.jsx)(k.ExternalLink,{className:"h-3.5 w-3.5"})})]})})]},a.id))})]})})})]}),u.length>0&&(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsx)(d.CardTitle,{children:"nextier"===a.clientId?"Nextier Proceeds":"Payables"})}),(0,b.jsx)(d.CardContent,{className:"p-0",children:(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)(i.Table,{children:[(0,b.jsx)(i.TableHeader,{children:(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableHead,{className:"w-[110px]",children:"Date"}),(0,b.jsx)(i.TableHead,{children:"Description"}),(0,b.jsx)(i.TableHead,{className:"w-[100px] text-right",children:"Amount"}),(0,b.jsx)(i.TableHead,{children:"Notes"})]})}),(0,b.jsx)(i.TableBody,{children:u.map(a=>(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableCell,{className:"text-muted-foreground",children:a.date?L(a.date):"—"}),(0,b.jsx)(i.TableCell,{className:"font-medium",children:a.description}),(0,b.jsx)(i.TableCell,{className:"text-right font-mono",children:(0,b.jsxs)("span",{className:"inline-flex items-center gap-1",children:[n(a.amount),a.links&&a.links.length>0&&(0,b.jsx)("button",{className:"text-muted-foreground hover:text-primary",onClick:()=>{B(a.links),D(!0)},"aria-label":"View links",children:(0,b.jsx)(k.ExternalLink,{className:"h-3.5 w-3.5"})})]})}),(0,b.jsx)(i.TableCell,{className:"max-w-[160px] text-muted-foreground",children:a.notes||"—"})]},a.id))}),(0,b.jsx)(i.TableFooter,{children:(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableCell,{colSpan:2,className:"font-semibold",children:"Total"}),(0,b.jsx)(i.TableCell,{className:"text-right font-mono font-semibold text-primary",children:n(u.reduce((a,b)=>a+b.amount,0))}),(0,b.jsx)(i.TableCell,{})]})})]})})})]}),(0,b.jsxs)(d.Card,{className:"ml-auto sm:max-w-[50%]",children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsx)(d.CardTitle,{children:"Grand Total"})}),(0,b.jsx)(d.CardContent,{children:(0,b.jsx)("div",{className:"flex justify-end",children:(0,b.jsxs)("div",{className:"flex flex-col items-end",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-0.5 items-end text-muted-foreground",children:[(a.totalTime>0||0===a.totalTime)&&q.length>0&&(0,b.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,b.jsx)("span",{children:"Time Tracking"}),(0,b.jsx)("span",{className:"font-mono",children:n(a.totalTime)})]}),a.totalSubscriptions>0&&(0,b.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,b.jsx)("span",{children:"Subscriptions"}),(0,b.jsx)("span",{className:"font-mono",children:n(a.totalSubscriptions)})]}),a.totalPayables>0&&(0,b.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,b.jsx)("span",{children:"nextier"===a.clientId?"Proceeds":"Payables"}),(0,b.jsxs)("span",{className:"font-mono",children:["nextier"===a.clientId?"":"−",n(a.totalPayables)]})]})]}),(0,b.jsx)("div",{className:"mt-1 border-t border-border pt-1 w-full text-right",children:(0,b.jsx)("span",{className:"font-mono font-bold text-primary",children:n(a.grandTotal)})})]})})})]}),(0,b.jsx)(h.Dialog,{open:C,onOpenChange:D,children:(0,b.jsxs)(h.DialogContent,{className:"sm:max-w-md",children:[(0,b.jsxs)(h.DialogHeader,{children:[(0,b.jsx)(h.DialogTitle,{children:"Links"}),(0,b.jsxs)(h.DialogDescription,{children:[A.length," link(s)"]})]}),(0,b.jsx)("div",{className:"flex flex-col gap-2",children:A.map((a,c)=>(0,b.jsxs)("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-sm text-primary hover:underline",children:[(0,b.jsx)(k.ExternalLink,{className:"h-3.5 w-3.5 shrink-0"}),a.label||a.url]},c))}),(0,b.jsx)(h.DialogFooter,{children:(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>D(!1),children:"Close"})})]})}),o&&(0,b.jsx)(h.Dialog,{open:y,onOpenChange:z,children:(0,b.jsxs)(h.DialogContent,{className:"sm:max-w-sm",children:[(0,b.jsxs)(h.DialogHeader,{children:[(0,b.jsx)(h.DialogTitle,{children:"Update Rate"}),(0,b.jsxs)(h.DialogDescription,{children:["Set an hourly rate or flat rate to recalculate the time cost for this invoice. Total hours: ",K.toFixed(2)]})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,b.jsx)(g.Label,{htmlFor:"rate-hourly",children:"Hourly Rate"}),(0,b.jsx)(f.Input,{id:"rate-hourly",type:"number",placeholder:"e.g. 75",min:"0",step:"0.01",value:E,onChange:a=>F(a.target.value),disabled:!!G.trim()})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,b.jsx)(g.Label,{htmlFor:"rate-flat",children:"Flat Rate"}),(0,b.jsx)(f.Input,{id:"rate-flat",type:"number",placeholder:"e.g. 5000",min:"0",step:"0.01",value:G,onChange:a=>H(a.target.value),disabled:!!E.trim()})]})]}),(E.trim()||G.trim())&&(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["New time cost: ",n(G.trim()?Number(G):K*Number(E))]})]}),(0,b.jsxs)(h.DialogFooter,{children:[(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>z(!1),children:"Cancel"}),(0,b.jsx)(e.Button,{disabled:I||!E.trim()&&!G.trim(),onClick:async()=>{J(!0);try{let b=G.trim()?Math.round(100*Number(G))/100:Math.round(K*Number(E)*100)/100,c="nextier"===a.clientId?a.totalPayables:Math.round((b+a.totalSubscriptions-a.totalPayables)*100)/100,d=await (0,l.updateInvoice)(p,a.id,{total_time:b,grand_total:c});o(d),z(!1)}catch{}finally{J(!1)}},children:I?"Saving...":"Update Rate"})]})]})})]})}a.s(["ArchivedInvoiceView",()=>o])}];

//# sourceMappingURL=_d519ea4f._.js.map