(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,83218,84762,96626,30374,7233,88699,78917,31785,36441,79173,e=>{"use strict";var t=e.i(43476),l=e.i(71645),a=e.i(70065),s=e.i(67881),n=e.i(23750),r=e.i(10708),i=e.i(47163);let c=l.forwardRef(({className:e,...l},a)=>(0,t.jsx)("textarea",{className:(0,i.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:a,...l}));c.displayName="Textarea",e.s(["Textarea",()=>c],84762);var d=e.i(47627),o=e.i(81140),m=e.i(20783),x=e.i(30030),u=e.i(10772),h=e.i(69340),p=e.i(26330),f=e.i(65491),j=e.i(74606),g=e.i(34620),b=e=>{var t;let a,s,{present:n,children:r}=e,i=function(e){var t,a;let[s,n]=l.useState(),r=l.useRef({}),i=l.useRef(e),c=l.useRef("none"),[d,o]=(t=e?"mounted":"unmounted",a={mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}},l.useReducer((e,t)=>a[e][t]??e,t));return l.useEffect(()=>{let e=N(r.current);c.current="mounted"===d?e:"none"},[d]),(0,g.useLayoutEffect)(()=>{let t=r.current,l=i.current;if(l!==e){let a=c.current,s=N(t);e?o("MOUNT"):"none"===s||t?.display==="none"?o("UNMOUNT"):l&&a!==s?o("ANIMATION_OUT"):o("UNMOUNT"),i.current=e}},[e,o]),(0,g.useLayoutEffect)(()=>{if(s){let e,t=s.ownerDocument.defaultView??window,l=l=>{let a=N(r.current).includes(l.animationName);if(l.target===s&&a&&(o("ANIMATION_END"),!i.current)){let l=s.style.animationFillMode;s.style.animationFillMode="forwards",e=t.setTimeout(()=>{"forwards"===s.style.animationFillMode&&(s.style.animationFillMode=l)})}},a=e=>{e.target===s&&(c.current=N(r.current))};return s.addEventListener("animationstart",a),s.addEventListener("animationcancel",l),s.addEventListener("animationend",l),()=>{t.clearTimeout(e),s.removeEventListener("animationstart",a),s.removeEventListener("animationcancel",l),s.removeEventListener("animationend",l)}}o("ANIMATION_END")},[s,o]),{isPresent:["mounted","unmountSuspended"].includes(d),ref:l.useCallback(e=>{e&&(r.current=getComputedStyle(e)),n(e)},[])}}(n),c="function"==typeof r?r({present:i.isPresent}):l.Children.only(r),d=(0,m.useComposedRefs)(i.ref,(t=c,(s=(a=Object.getOwnPropertyDescriptor(t.props,"ref")?.get)&&"isReactWarning"in a&&a.isReactWarning)?t.ref:(s=(a=Object.getOwnPropertyDescriptor(t,"ref")?.get)&&"isReactWarning"in a&&a.isReactWarning)?t.props.ref:t.props.ref||t.ref));return"function"==typeof r||i.isPresent?l.cloneElement(c,{ref:d}):null};function N(e){return e?.animationName||"none"}b.displayName="Presence",e.s(["Presence",()=>b],96626);var y=e.i(48425),v=e.i(3536),C=e.i(85369),w=e.i(86312),T=e.i(91918),k="Dialog",[S,D]=(0,x.createContextScope)(k),[F,R]=S(k),I=e=>{let{__scopeDialog:a,children:s,open:n,defaultOpen:r,onOpenChange:i,modal:c=!0}=e,d=l.useRef(null),o=l.useRef(null),[m=!1,x]=(0,h.useControllableState)({prop:n,defaultProp:r,onChange:i});return(0,t.jsx)(F,{scope:a,triggerRef:d,contentRef:o,contentId:(0,u.useId)(),titleId:(0,u.useId)(),descriptionId:(0,u.useId)(),open:m,onOpenChange:x,onOpenToggle:l.useCallback(()=>x(e=>!e),[x]),modal:c,children:s})};I.displayName=k;var H="DialogTrigger";l.forwardRef((e,l)=>{let{__scopeDialog:a,...s}=e,n=R(H,a),r=(0,m.useComposedRefs)(l,n.triggerRef);return(0,t.jsx)(y.Primitive.button,{type:"button","aria-haspopup":"dialog","aria-expanded":n.open,"aria-controls":n.contentId,"data-state":Z(n.open),...s,ref:r,onClick:(0,o.composeEventHandlers)(e.onClick,n.onOpenToggle)})}).displayName=H;var E="DialogPortal",[A,B]=S(E,{forceMount:void 0}),P=e=>{let{__scopeDialog:a,forceMount:s,children:n,container:r}=e,i=R(E,a);return(0,t.jsx)(A,{scope:a,forceMount:s,children:l.Children.map(n,e=>(0,t.jsx)(b,{present:s||i.open,children:(0,t.jsx)(j.Portal,{asChild:!0,container:r,children:e})}))})};P.displayName=E;var M="DialogOverlay",L=l.forwardRef((e,l)=>{let a=B(M,e.__scopeDialog),{forceMount:s=a.forceMount,...n}=e,r=R(M,e.__scopeDialog);return r.modal?(0,t.jsx)(b,{present:s||r.open,children:(0,t.jsx)($,{...n,ref:l})}):null});L.displayName=M;var $=l.forwardRef((e,l)=>{let{__scopeDialog:a,...s}=e,n=R(M,a);return(0,t.jsx)(C.RemoveScroll,{as:T.Slot,allowPinchZoom:!0,shards:[n.contentRef],children:(0,t.jsx)(y.Primitive.div,{"data-state":Z(n.open),...s,ref:l,style:{pointerEvents:"auto",...s.style}})})}),O="DialogContent",U=l.forwardRef((e,l)=>{let a=B(O,e.__scopeDialog),{forceMount:s=a.forceMount,...n}=e,r=R(O,e.__scopeDialog);return(0,t.jsx)(b,{present:s||r.open,children:r.modal?(0,t.jsx)(z,{...n,ref:l}):(0,t.jsx)(_,{...n,ref:l})})});U.displayName=O;var z=l.forwardRef((e,a)=>{let s=R(O,e.__scopeDialog),n=l.useRef(null),r=(0,m.useComposedRefs)(a,s.contentRef,n);return l.useEffect(()=>{let e=n.current;if(e)return(0,w.hideOthers)(e)},[]),(0,t.jsx)(V,{...e,ref:r,trapFocus:s.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:(0,o.composeEventHandlers)(e.onCloseAutoFocus,e=>{e.preventDefault(),s.triggerRef.current?.focus()}),onPointerDownOutside:(0,o.composeEventHandlers)(e.onPointerDownOutside,e=>{let t=e.detail.originalEvent,l=0===t.button&&!0===t.ctrlKey;(2===t.button||l)&&e.preventDefault()}),onFocusOutside:(0,o.composeEventHandlers)(e.onFocusOutside,e=>e.preventDefault())})}),_=l.forwardRef((e,a)=>{let s=R(O,e.__scopeDialog),n=l.useRef(!1),r=l.useRef(!1);return(0,t.jsx)(V,{...e,ref:a,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:t=>{e.onCloseAutoFocus?.(t),t.defaultPrevented||(n.current||s.triggerRef.current?.focus(),t.preventDefault()),n.current=!1,r.current=!1},onInteractOutside:t=>{e.onInteractOutside?.(t),t.defaultPrevented||(n.current=!0,"pointerdown"===t.detail.originalEvent.type&&(r.current=!0));let l=t.target;s.triggerRef.current?.contains(l)&&t.preventDefault(),"focusin"===t.detail.originalEvent.type&&r.current&&t.preventDefault()}})}),V=l.forwardRef((e,a)=>{let{__scopeDialog:s,trapFocus:n,onOpenAutoFocus:r,onCloseAutoFocus:i,...c}=e,d=R(O,s),o=l.useRef(null),x=(0,m.useComposedRefs)(a,o);return(0,v.useFocusGuards)(),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(f.FocusScope,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:r,onUnmountAutoFocus:i,children:(0,t.jsx)(p.DismissableLayer,{role:"dialog",id:d.contentId,"aria-describedby":d.descriptionId,"aria-labelledby":d.titleId,"data-state":Z(d.open),...c,ref:x,onDismiss:()=>d.onOpenChange(!1)})}),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(et,{titleId:d.titleId}),(0,t.jsx)(el,{contentRef:o,descriptionId:d.descriptionId})]})]})}),W="DialogTitle",K=l.forwardRef((e,l)=>{let{__scopeDialog:a,...s}=e,n=R(W,a);return(0,t.jsx)(y.Primitive.h2,{id:n.titleId,...s,ref:l})});K.displayName=W;var X="DialogDescription",Y=l.forwardRef((e,l)=>{let{__scopeDialog:a,...s}=e,n=R(X,a);return(0,t.jsx)(y.Primitive.p,{id:n.descriptionId,...s,ref:l})});Y.displayName=X;var q="DialogClose",G=l.forwardRef((e,l)=>{let{__scopeDialog:a,...s}=e,n=R(q,a);return(0,t.jsx)(y.Primitive.button,{type:"button",...s,ref:l,onClick:(0,o.composeEventHandlers)(e.onClick,()=>n.onOpenChange(!1))})});function Z(e){return e?"open":"closed"}G.displayName=q;var J="DialogTitleWarning",[Q,ee]=(0,x.createContext)(J,{contentName:O,titleName:W,docsSlug:"dialog"}),et=({titleId:e})=>{let t=ee(J),a=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return l.useEffect(()=>{e&&(document.getElementById(e)||console.error(a))},[a,e]),null},el=({contentRef:e,descriptionId:t})=>{let a=ee("DialogDescriptionWarning"),s=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${a.contentName}}.`;return l.useEffect(()=>{let l=e.current?.getAttribute("aria-describedby");t&&l&&(document.getElementById(t)||console.warn(s))},[s,e,t]),null},ea=e.i(37727);let es=l.forwardRef(({className:e,...l},a)=>(0,t.jsx)(L,{ref:a,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...l}));es.displayName=L.displayName;let en=l.forwardRef(({className:e,children:l,...a},s)=>(0,t.jsxs)(P,{children:[(0,t.jsx)(es,{}),(0,t.jsxs)(U,{ref:s,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...a,children:[l,(0,t.jsxs)(G,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,t.jsx)(ea.X,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Close"})]})]})]}));en.displayName=U.displayName;let er=({className:e,...l})=>(0,t.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",e),...l});er.displayName="DialogHeader";let ei=({className:e,...l})=>(0,t.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...l});ei.displayName="DialogFooter";let ec=l.forwardRef(({className:e,...l},a)=>(0,t.jsx)(K,{ref:a,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",e),...l}));ec.displayName=K.displayName;let ed=l.forwardRef(({className:e,...l},a)=>(0,t.jsx)(Y,{ref:a,className:(0,i.cn)("text-sm text-muted-foreground",e),...l}));ed.displayName=Y.displayName,e.s(["Dialog",()=>I,"DialogContent",()=>en,"DialogDescription",()=>ed,"DialogFooter",()=>ei,"DialogHeader",()=>er,"DialogTitle",()=>ec],30374);var eo=e.i(62870),em=e.i(7910),ex=e.i(17927),eu=e.i(91432),eh=e.i(75254);let ep=(0,eh.default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>ep],7233);let ef=(0,eh.default)("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);e.s(["Pencil",()=>ef],88699);let ej=(0,eh.default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]),eg=(0,eh.default)("paperclip",[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]]),eb=(0,eh.default)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]),eN=(0,eh.default)("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);function ey(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(e)}function ev(e){let[t,l]=e.split(":"),a=parseInt(t,10);return`${0===a?12:a>12?a-12:a}:${l} ${a>=12?"PM":"AM"}`}e.s(["ExternalLink",()=>eN],78917);let eC={date:"",startTime:"",endTime:"",tasks:"",notes:"",links:[]};function ew({editMode:e=!1,clientId:i="cygnet",hourlyRate:o=null,flatRate:m=null,refreshKey:x=0,billingPeriodEnd:u=null,onRateChange:h}){let{supabase:p}=(0,eu.useAuth)(),[f,j]=(0,l.useState)(!1),[g,b]=(0,l.useState)(""),[N,y]=(0,l.useState)(""),[v,C]=(0,l.useState)([]),[w,T]=(0,l.useState)(!1),[k,S]=(0,l.useState)(null),[D,F]=(0,l.useState)(!1),[R,H]=(0,l.useState)(null),[E,A]=(0,l.useState)(eC),[B,P]=(0,l.useState)(null),[M,L]=(0,l.useState)([]),[$,O]=(0,l.useState)([]),[U,z]=(0,l.useState)([]),[_,V]=(0,l.useState)(!1),[W,K]=(0,l.useState)(null),[X,Y]=(0,l.useState)(null),q=(0,l.useMemo)(()=>{let e=v.map(e=>e.date).filter(Boolean).sort();if(0===e.length)return null;let t=e=>`${String(e.getMonth()+1).padStart(2,"0")}/${String(e.getDate()).padStart(2,"0")}/${e.getFullYear()}`,l=t(new Date(e[0]+"T00:00:00"));return u?`${l} - ${t(new Date(u+"T00:00:00"))}`:`${l} - Present`},[v,u]),G=(0,l.useMemo)(()=>(function(){let e=[];for(let t=6;t<=23;t++)for(let l=0;l<60;l+=15){let a=String(t).padStart(2,"0"),s=String(l).padStart(2,"0"),n=`${a}:${s}`,r=t>=12?"PM":"AM",i=0===t?12:t>12?t-12:t,c=`${i}:${s} ${r}`;e.push({value:n,label:c})}return e})(),[]);(0,l.useEffect)(()=>{let e=!1;return T(!1),S(null),async function(){try{let t=await (0,ex.fetchTimeEntries)(p,i);if(e)return;C(t)}catch(t){e||S(t instanceof Error?t.message:"object"==typeof t&&null!==t&&"message"in t?String(t.message):"Failed to load time entries")}finally{e||T(!0)}}(),()=>{e=!0}},[i,p,x]);let Z=v.reduce((e,t)=>e+t.totalHours,0),J=0===v.length?null:null!=m?m:null!=o?Z*o:null,Q=function(e,t){if(!e||!t)return 0;let[l,a]=e.split(":").map(Number),[s,n]=t.split(":").map(Number),r=60*l+a,i=60*s+n;return i<=r&&(i+=1440),Math.round((i-r)/60*100)/100}(E.startTime,E.endTime);async function ee(){if(!E.date||!E.startTime||E.endTime&&Q<=0)return;let e=E.endTime?`${ev(E.startTime)} - ${ev(E.endTime)}`:`${ev(E.startTime)} - In Progress`,t=R?.id??crypto.randomUUID();try{for(let e of(V(!0),U))await (0,ex.deleteAttachment)(p,e.path);let l=[];for(let e of M){let a=await (0,ex.uploadAttachment)(p,e,i,t);l.push(a)}let a=[...$.filter(e=>!U.some(t=>t.path===e.path)),...l],s={date:E.date,startTime:E.startTime,endTime:E.endTime,timeRange:e,totalHours:E.endTime?Q:0,tasks:E.tasks,notes:E.notes,attachments:a,links:E.links.filter(e=>e.url.trim())};if(R){let e={...R,...s};C(t=>t.map(t=>t.id===R.id?e:t)),await (0,ex.upsertTimeEntry)(p,e,i)}else{let e={id:t,...s};C(t=>[...t,e]),await (0,ex.upsertTimeEntry)(p,e,i)}F(!1)}catch(e){S(e instanceof Error?e.message:"Failed to save time entry");try{let e=await (0,ex.fetchTimeEntries)(p,i);C(e)}catch{}}finally{V(!1)}}async function et(e){let t=v.find(t=>t.id===e);C(v.filter(t=>t.id!==e)),P(null);try{t?.attachments?.length&&await (0,ex.deleteAllAttachments)(p,t.attachments),await (0,ex.deleteTimeEntry)(p,e)}catch(e){S(e instanceof Error?e.message:"Failed to delete time entry"),C(v)}}return w?(0,t.jsxs)("div",{className:"flex flex-col gap-6",children:[k&&(0,t.jsx)(a.Card,{className:"border-destructive",children:(0,t.jsxs)(a.CardContent,{className:"p-4text-destructive",children:[k,(0,t.jsx)(s.Button,{variant:"ghost",size:"sm",className:"ml-2",onClick:()=>S(null),children:"Dismiss"})]})}),v.length>0&&(0,t.jsx)(a.Card,{children:(0,t.jsxs)(a.CardHeader,{children:[(0,t.jsxs)("div",{className:"invoice-print hidden print:flex justify-between items-start",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-0.5",children:[(0,t.jsx)(a.CardTitle,{children:"Invoice Details"}),q&&(0,t.jsx)("span",{className:"text-muted-foreground",children:q})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1 items-end text-right",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Payable To: "}),(0,t.jsx)("span",{className:"font-medium",children:em.timeTrackingMeta.payableTo})]}),(0,t.jsx)("div",{className:"text-muted-foreground",children:"2680 Diane Marie Ct, Waterford, MI 48329"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Venmo: "}),(0,t.jsx)("span",{className:"font-medium",children:"@MelkonianLLC"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:null!=m?"Flat Rate: ":"Hourly Rate: "}),(0,t.jsx)("span",{className:"font-medium",children:null!=m?ey(m):null!=o?ey(o):"TBD"})]})]})]}),(0,t.jsxs)("div",{className:"invoice-screen grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-0.5",children:[(0,t.jsx)(a.CardTitle,{children:"Invoice Details"}),q&&(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:q})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-0.5 items-start",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Payable To"}),(0,t.jsx)("span",{className:"font-medium",children:em.timeTrackingMeta.payableTo}),(0,t.jsxs)("span",{className:"text-muted-foreground",children:["2680 Diane Marie Ct",(0,t.jsx)("br",{}),"Waterford, MI 48329"]})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-0.5 items-start",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Venmo"}),(0,t.jsx)("span",{className:"font-medium",children:"@MelkonianLLC"})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-0.5 items-start",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:null!=m?"Flat Rate":"Hourly Rate"}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("span",{className:"font-medium",children:null!=m?ey(m):null!=o?ey(o):"TBD"}),h&&(0,t.jsx)("button",{className:"text-muted-foreground hover:text-primary print:hidden",onClick:()=>{b(null!=o?String(o):""),y(null!=m?String(m):""),j(!0)},"aria-label":"Edit rate",children:(0,t.jsx)(ef,{className:"h-3.5 w-3.5"})})]})]})]})]})}),(v.length>0||e)&&(0,t.jsxs)(a.Card,{children:[(0,t.jsxs)(a.CardHeader,{className:"flex flex-row items-center justify-between pb-4",children:[(0,t.jsx)("div",{children:(0,t.jsx)(a.CardTitle,{children:"Time Tracking"})}),e&&(0,t.jsxs)(s.Button,{onClick:function(){H(null),A(eC),L([]),O([]),z([]),F(!0)},size:"sm",children:[(0,t.jsx)(ep,{className:"mr-1.5 h-4 w-4"}),"Add Entry"]})]}),v.length>0&&(0,t.jsx)(a.CardContent,{className:"p-0",children:(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)(d.Table,{children:[(0,t.jsx)(d.TableHeader,{children:(0,t.jsxs)(d.TableRow,{children:[(0,t.jsx)(d.TableHead,{className:"w-[110px]",children:"Date"}),(0,t.jsx)(d.TableHead,{children:"Tasks"}),(0,t.jsx)(d.TableHead,{className:"w-[110px]",children:"Time Range"}),(0,t.jsx)(d.TableHead,{className:"w-[80px] text-right",children:"Hours"}),(0,t.jsx)(d.TableHead,{className:"w-[100px] text-right",children:"Cost"}),e&&(0,t.jsx)(d.TableHead,{className:"w-[100px] text-right",children:"Actions"})]})}),(0,t.jsx)(d.TableBody,{children:v.map(l=>{let a;return(0,t.jsxs)(d.TableRow,{children:[(0,t.jsx)(d.TableCell,{className:"whitespace-nowrap font-medium",children:(a=new Date(l.date+"T00:00:00"),`${String(a.getMonth()+1).padStart(2,"0")}/${String(a.getDate()).padStart(2,"0")}/${a.getFullYear()}`)}),(0,t.jsx)(d.TableCell,{className:"max-w-[220px] text-muted-foreground",children:l.tasks}),(0,t.jsx)(d.TableCell,{className:"whitespace-nowrap",children:l.timeRange}),(0,t.jsx)(d.TableCell,{className:"text-right font-mono",children:l.totalHours.toFixed(2)}),(0,t.jsx)(d.TableCell,{className:"text-right font-monotext-muted-foreground",children:(0,t.jsxs)("span",{className:"inline-flex items-center gap-1.5",children:[null!=m?"—":null!=o?ey(l.totalHours*o):"TBD",l.attachments?.length>0&&(0,t.jsx)("button",{type:"button",className:"inline-flex text-muted-foreground hover:text-primary",title:`${l.attachments.length} receipt(s)`,onClick:()=>K(l),children:(0,t.jsx)(eg,{className:"h-3.5 w-3.5"})}),l.links?.length>0&&(0,t.jsx)("button",{type:"button",className:"inline-flex text-muted-foreground hover:text-primary",title:`${l.links.length} link(s)`,onClick:()=>Y(l),children:(0,t.jsx)(eN,{className:"h-3.5 w-3.5"})})]})}),e&&(0,t.jsx)(d.TableCell,{className:"text-right",children:(0,t.jsxs)("div",{className:"flex items-center justify-end gap-1",children:[(0,t.jsx)(s.Button,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>{H(l),A({date:l.date,startTime:l.startTime||"",endTime:l.endTime||"",tasks:l.tasks,notes:l.notes,links:l.links??[]}),L([]),O(l.attachments??[]),z([]),F(!0)},"aria-label":"Edit entry",children:(0,t.jsx)(ef,{className:"h-3.5 w-3.5"})}),(0,t.jsx)(s.Button,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive hover:text-destructive",onClick:()=>P(l.id),"aria-label":"Delete entry",children:(0,t.jsx)(ej,{className:"h-3.5 w-3.5"})})]})})]},l.id)})}),(0,t.jsx)(d.TableFooter,{children:(0,t.jsxs)(d.TableRow,{children:[(0,t.jsx)(d.TableCell,{colSpan:3,className:"font-semibold",children:"Total"}),(0,t.jsx)(d.TableCell,{className:"text-right font-mono font-semibold",children:Z.toFixed(2)}),(0,t.jsx)(d.TableCell,{className:"text-right font-mono font-semibold text-primary",children:null!=J?ey(J):"TBD"}),e&&(0,t.jsx)(d.TableCell,{})]})})]})})})]}),(0,t.jsx)(I,{open:D,onOpenChange:F,children:(0,t.jsxs)(en,{className:"sm:max-w-md",children:[(0,t.jsxs)(er,{children:[(0,t.jsx)(ec,{children:R?"Edit Time Entry":"Add Time Entry"}),(0,t.jsx)(ed,{children:R?"Update the details of this time entry.":"Select start and end times to automatically calculate hours."})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,t.jsx)(r.Label,{htmlFor:"entry-date",children:"Date"}),(0,t.jsx)(n.Input,{id:"entry-date",type:"date",value:E.date,onChange:e=>A({...E,date:e.target.value})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,t.jsx)(r.Label,{children:"Start Time"}),(0,t.jsxs)(eo.Select,{value:E.startTime,onValueChange:e=>A({...E,startTime:e}),children:[(0,t.jsx)(eo.SelectTrigger,{children:(0,t.jsx)(eo.SelectValue,{placeholder:"Select start"})}),(0,t.jsx)(eo.SelectContent,{children:G.map(e=>(0,t.jsx)(eo.SelectItem,{value:e.value,children:e.label},e.value))})]})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,t.jsx)(r.Label,{children:"End Time"}),(0,t.jsxs)(eo.Select,{value:E.endTime,onValueChange:e=>A({...E,endTime:e}),children:[(0,t.jsx)(eo.SelectTrigger,{children:(0,t.jsx)(eo.SelectValue,{placeholder:"Select end"})}),(0,t.jsx)(eo.SelectContent,{children:G.map(e=>(0,t.jsx)(eo.SelectItem,{value:e.value,children:e.label},e.value))})]})]})]}),E.startTime&&E.endTime&&(0,t.jsxs)("div",{className:"flex items-center gap-3 rounded-md border border-border bg-muted/50 px-4 py-3",children:[(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Calculated Hours"}),(0,t.jsx)("span",{className:"font-mono font-bold",children:Q>0?Q.toFixed(2):"Invalid range"})]}),Q>0&&null==m&&(0,t.jsxs)("div",{className:"ml-auto flex flex-col text-right",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Estimated Cost"}),(0,t.jsx)("span",{className:"font-mono font-bold text-primary",children:null!=o?ey(Q*o):"TBD"})]})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,t.jsx)(r.Label,{htmlFor:"entry-tasks",children:"Tasks"}),(0,t.jsx)(c,{id:"entry-tasks",placeholder:"Describe the work performed...",rows:3,value:E.tasks,onChange:e=>A({...E,tasks:e.target.value})})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,t.jsx)(r.Label,{children:"Receipts"}),(0,t.jsx)("input",{type:"file",accept:"image/*,.pdf,application/pdf",multiple:!0,className:"text-sm file:mr-3 file:rounded-md file:border-0 file:bg-primary file:px-3 file:py-1.5 file:text-sm file:font-medium file:text-primary-foreground hover:file:bg-primary/90",onChange:e=>{let t=Array.from(e.target.files??[]).filter(e=>!(e.size>5242880)||(S(`"${e.name}" exceeds 5 MB limit`),!1));L(e=>[...e,...t]),e.target.value=""}}),$.filter(e=>!U.some(t=>t.path===e.path)).map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-2 rounded-md border px-3 py-1.5 text-sm",children:[(0,t.jsx)(eg,{className:"h-3.5 w-3.5 shrink-0 text-muted-foreground"}),(0,t.jsx)("span",{className:"truncate",children:e.name}),(0,t.jsxs)("span",{className:"ml-auto text-muted-foreground",children:[(e.size/1024).toFixed(0)," KB"]}),(0,t.jsx)("button",{type:"button",className:"text-destructive hover:text-destructive/80",onClick:()=>z(t=>[...t,e]),children:(0,t.jsx)(ea.X,{className:"h-3.5 w-3.5"})})]},e.path)),M.map((e,l)=>(0,t.jsxs)("div",{className:"flex items-center gap-2 rounded-md border border-dashed px-3 py-1.5 text-sm",children:[(0,t.jsx)(eg,{className:"h-3.5 w-3.5 shrink-0 text-muted-foreground"}),(0,t.jsx)("span",{className:"truncate",children:e.name}),(0,t.jsxs)("span",{className:"ml-auto text-muted-foreground",children:[(e.size/1024).toFixed(0)," KB"]}),(0,t.jsx)("button",{type:"button",className:"text-destructive hover:text-destructive/80",onClick:()=>L(e=>e.filter((e,t)=>t!==l)),children:(0,t.jsx)(ea.X,{className:"h-3.5 w-3.5"})})]},`pending-${l}`))]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,t.jsx)(r.Label,{children:"Links"}),E.links.map((e,l)=>(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(n.Input,{placeholder:"Label",value:e.label,onChange:e=>{let t=[...E.links];t[l]={...t[l],label:e.target.value},A({...E,links:t})},className:"w-1/3"}),(0,t.jsx)(n.Input,{placeholder:"https://...",value:e.url,onChange:e=>{let t=[...E.links];t[l]={...t[l],url:e.target.value},A({...E,links:t})},className:"flex-1"}),(0,t.jsx)("button",{type:"button",className:"text-destructive hover:text-destructive/80",onClick:()=>A({...E,links:E.links.filter((e,t)=>t!==l)}),children:(0,t.jsx)(ea.X,{className:"h-3.5 w-3.5"})})]},l)),(0,t.jsxs)(s.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>A({...E,links:[...E.links,{url:"",label:""}]}),children:[(0,t.jsx)(ep,{className:"mr-1.5 h-3.5 w-3.5"})," Add Link"]})]})]}),(0,t.jsxs)(ei,{children:[(0,t.jsx)(s.Button,{variant:"outline",onClick:()=>F(!1),children:"Cancel"}),(0,t.jsx)(s.Button,{onClick:ee,disabled:_||!E.date||!E.startTime||!!E.endTime&&Q<=0,children:_?"Uploading...":R?"Save Changes":"Add Entry"})]})]})}),(0,t.jsx)(I,{open:null!==B,onOpenChange:()=>P(null),children:(0,t.jsxs)(en,{className:"sm:max-w-sm",children:[(0,t.jsxs)(er,{children:[(0,t.jsx)(ec,{children:"Delete Time Entry"}),(0,t.jsx)(ed,{children:"Are you sure you want to delete this time entry? This action cannot be undone."})]}),(0,t.jsxs)(ei,{children:[(0,t.jsx)(s.Button,{variant:"outline",onClick:()=>P(null),children:"Cancel"}),(0,t.jsx)(s.Button,{variant:"destructive",onClick:()=>B&&et(B),children:"Delete"})]})]})}),(0,t.jsx)(I,{open:null!==W,onOpenChange:()=>K(null),children:(0,t.jsxs)(en,{className:"sm:max-w-lg",children:[(0,t.jsxs)(er,{children:[(0,t.jsx)(ec,{children:"Receipts"}),(0,t.jsxs)(ed,{children:[W?.attachments?.length??0," receipt(s) attached to this entry."]})]}),(0,t.jsx)("div",{className:"flex flex-col gap-4 max-h-[60vh] overflow-y-auto",children:W?.attachments?.map(e=>{let l=(0,ex.getAttachmentUrl)(p,e.path);return(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[e.name.toLowerCase().endsWith(".pdf")?(0,t.jsx)("iframe",{src:l,title:e.name,className:"w-full rounded-md border h-64"}):(0,t.jsx)("img",{src:l,alt:e.name,className:"w-full rounded-md border object-contain max-h-64"}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)("span",{className:"truncate font-medium",children:e.name}),(0,t.jsxs)("span",{className:"text-muted-foreground",children:[(e.size/1024).toFixed(0)," KB"]}),(0,t.jsxs)("a",{href:l,download:e.name,target:"_blank",rel:"noopener noreferrer",className:"ml-auto inline-flex items-center gap-1 text-primary hover:underline",children:[(0,t.jsx)(eb,{className:"h-3.5 w-3.5"}),"Download"]})]})]},e.path)})}),(0,t.jsx)(ei,{children:(0,t.jsx)(s.Button,{variant:"outline",onClick:()=>K(null),children:"Close"})})]})}),(0,t.jsx)(I,{open:null!==X,onOpenChange:()=>Y(null),children:(0,t.jsxs)(en,{className:"sm:max-w-md",children:[(0,t.jsxs)(er,{children:[(0,t.jsx)(ec,{children:"Links"}),(0,t.jsxs)(ed,{children:[X?.links?.length??0," link(s)"]})]}),(0,t.jsx)("div",{className:"flex flex-col gap-2",children:X?.links?.map((e,l)=>(0,t.jsxs)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-sm text-primary hover:underline",children:[(0,t.jsx)(eN,{className:"h-3.5 w-3.5 shrink-0"}),e.label||e.url]},l))}),(0,t.jsx)(ei,{children:(0,t.jsx)(s.Button,{variant:"outline",onClick:()=>Y(null),children:"Close"})})]})}),h&&(0,t.jsx)(I,{open:f,onOpenChange:j,children:(0,t.jsxs)(en,{className:"sm:max-w-sm",children:[(0,t.jsxs)(er,{children:[(0,t.jsx)(ec,{children:"Update Rate"}),(0,t.jsx)(ed,{children:"Set an hourly rate or flat rate for this billing period."})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,t.jsx)(r.Label,{htmlFor:"edit-hourly-rate",children:"Hourly Rate"}),(0,t.jsx)(n.Input,{id:"edit-hourly-rate",type:"number",placeholder:"e.g. 75",min:"0",step:"0.01",value:g,onChange:e=>b(e.target.value),disabled:!!N.trim()})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,t.jsx)(r.Label,{htmlFor:"edit-flat-rate",children:"Flat Rate"}),(0,t.jsx)(n.Input,{id:"edit-flat-rate",type:"number",placeholder:"e.g. 5000",min:"0",step:"0.01",value:N,onChange:e=>y(e.target.value),disabled:!!g.trim()})]})]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Set either an hourly rate or a flat rate, not both."})]}),(0,t.jsxs)(ei,{children:[(0,t.jsx)(s.Button,{variant:"outline",onClick:()=>j(!1),children:"Cancel"}),(0,t.jsx)(s.Button,{onClick:()=>{h(g.trim()?Number(g):null,N.trim()?Number(N):null),j(!1)},disabled:!g.trim()&&!N.trim(),children:"Update Rate"})]})]})})]}):(0,t.jsx)(a.Card,{children:(0,t.jsx)(a.CardContent,{className:"p-8 text-center text-muted-foreground",children:"Loading time entries..."})})}function eT(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(e)}e.s(["TimeTrackingSection",()=>ew],83218);let ek={name:"",category:em.subscriptionCategories[0],billingCycle:"monthly",amount:0,renewalDate:"",notes:"",attachments:[],links:[]};function eS({editMode:e=!1,clientId:i="cygnet",refreshKey:c=0}){let{supabase:o}=(0,eu.useAuth)(),[m,x]=(0,l.useState)([]),[u,h]=(0,l.useState)(!1),[p,f]=(0,l.useState)(null),[j,g]=(0,l.useState)(!1),[b,N]=(0,l.useState)(null),[y,v]=(0,l.useState)(ek),[C,w]=(0,l.useState)([]),[T,k]=(0,l.useState)([]),[S,D]=(0,l.useState)([]),[F,R]=(0,l.useState)(!1),[H,E]=(0,l.useState)(null),[A,B]=(0,l.useState)(null);(0,l.useEffect)(()=>{let e=!1;return h(!1),f(null),async function(){try{let t=await (0,ex.fetchSubscriptions)(o,i);if(e)return;x(t)}catch(t){e||f(t instanceof Error?t.message:"Failed to load subscriptions")}finally{e||h(!0)}}(),()=>{e=!0}},[i,o,c]);let P=m.reduce((e,t)=>"monthly"===t.billingCycle?e+t.amount:e+t.amount/12,0),M=(0,l.useCallback)(()=>{N(null),v(ek),w([]),k([]),D([]),g(!0)},[]),L=(0,l.useCallback)(e=>{N(e.id),v({name:e.name,category:e.category,billingCycle:e.billingCycle,amount:e.amount,renewalDate:e.renewalDate,notes:e.notes,attachments:e.attachments??[],links:e.links??[]}),w([]),k(e.attachments??[]),D([]),g(!0)},[]),$=(0,l.useCallback)(async()=>{if(!y.name.trim())return;let e=b??crypto.randomUUID();try{for(let e of(R(!0),S))await (0,ex.deleteAttachment)(o,e.path);let t=[];for(let l of C){let a=await (0,ex.uploadAttachment)(o,l,i,e);t.push(a)}let l=[...T.filter(e=>!S.some(t=>t.path===e.path)),...t];if(b){let e={id:b,...y,attachments:l};x(t=>t.map(t=>t.id===b?e:t)),await (0,ex.upsertSubscription)(o,e,i)}else{let t={id:e,...y,attachments:l};x(e=>[...e,t]),await (0,ex.upsertSubscription)(o,t,i)}g(!1)}catch(e){f(e instanceof Error?e.message:"Failed to save subscription");try{let e=await (0,ex.fetchSubscriptions)(o,i);x(e)}catch{}}finally{R(!1)}},[b,y,i,o,C,T,S]),O=(0,l.useCallback)(async e=>{let t=m.find(t=>t.id===e);x(t=>t.filter(t=>t.id!==e));try{t?.attachments?.length&&await (0,ex.deleteAllAttachments)(o,t.attachments),await (0,ex.deleteSubscription)(o,e)}catch(e){f(e instanceof Error?e.message:"Failed to delete subscription"),x(m)}},[m]);return u&&(0!==m.length||e)?(0,t.jsxs)("div",{className:"flex flex-col gap-6",children:[p&&(0,t.jsx)(a.Card,{className:"border-destructive",children:(0,t.jsxs)(a.CardContent,{className:"p-4text-destructive",children:[p,(0,t.jsx)(s.Button,{variant:"ghost",size:"sm",className:"ml-2",onClick:()=>f(null),children:"Dismiss"})]})}),(0,t.jsxs)(a.Card,{children:[(0,t.jsxs)(a.CardHeader,{className:"flex flex-row items-center justify-between pb-4",children:[(0,t.jsx)("div",{children:(0,t.jsx)(a.CardTitle,{children:"Software Subscriptions"})}),e&&(0,t.jsxs)(s.Button,{size:"sm",onClick:M,className:"gap-1.5",children:[(0,t.jsx)(ep,{className:"h-4 w-4"}),"Add Subscription"]})]}),m.length>0&&(0,t.jsx)(a.CardContent,{className:"p-0",children:(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)(d.Table,{children:[(0,t.jsx)(d.TableHeader,{children:(0,t.jsxs)(d.TableRow,{children:[(0,t.jsx)(d.TableHead,{children:"Name"}),(0,t.jsx)(d.TableHead,{children:"Category"}),(0,t.jsx)(d.TableHead,{className:"w-[110px]",children:"Billing Cycle"}),(0,t.jsx)(d.TableHead,{className:"w-[110px]",children:"Renewal Date"}),(0,t.jsx)(d.TableHead,{children:"Notes"}),(0,t.jsx)(d.TableHead,{className:"w-[100px] text-right",children:"Amount"}),e&&(0,t.jsx)(d.TableHead,{className:"w-[100px] text-right",children:"Actions"})]})}),(0,t.jsx)(d.TableBody,{children:m.map(l=>{let a;return(0,t.jsxs)(d.TableRow,{children:[(0,t.jsx)(d.TableCell,{className:"font-medium",children:l.name}),(0,t.jsx)(d.TableCell,{className:"text-muted-foreground",children:l.category}),(0,t.jsx)(d.TableCell,{className:"capitalize",children:l.billingCycle}),(0,t.jsx)(d.TableCell,{className:"text-muted-foreground",children:l.renewalDate?(a=new Date(l.renewalDate+"T00:00:00"),`${String(a.getMonth()+1).padStart(2,"0")}/${String(a.getDate()).padStart(2,"0")}/${a.getFullYear()}`):"—"}),(0,t.jsx)(d.TableCell,{className:"max-w-[160px] text-muted-foreground",children:l.notes||"—"}),(0,t.jsx)(d.TableCell,{className:"text-right font-mono",children:(0,t.jsxs)("span",{className:"inline-flex items-center gap-1.5",children:[eT(l.amount),(0,t.jsxs)("span",{className:"ml-1 text-muted-foreground",children:["/","monthly"===l.billingCycle?"mo":"yr"]}),l.attachments?.length>0&&(0,t.jsx)("button",{type:"button",className:"inline-flex text-muted-foreground hover:text-primary",title:`${l.attachments.length} receipt(s)`,onClick:()=>E(l),children:(0,t.jsx)(eg,{className:"h-3.5 w-3.5"})}),l.links?.length>0&&(0,t.jsx)("button",{type:"button",className:"inline-flex text-muted-foreground hover:text-primary",title:`${l.links.length} link(s)`,onClick:()=>B(l),children:(0,t.jsx)(eN,{className:"h-3.5 w-3.5"})})]})}),e&&(0,t.jsx)(d.TableCell,{className:"text-right",children:(0,t.jsxs)("div",{className:"flex items-center justify-end gap-1",children:[(0,t.jsxs)(s.Button,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>L(l),children:[(0,t.jsx)(ef,{className:"h-3.5 w-3.5"}),(0,t.jsx)("span",{className:"sr-only",children:"Edit"})]}),(0,t.jsxs)(s.Button,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive hover:text-destructive",onClick:()=>O(l.id),children:[(0,t.jsx)(ej,{className:"h-3.5 w-3.5"}),(0,t.jsx)("span",{className:"sr-only",children:"Delete"})]})]})})]},l.id)})}),(0,t.jsx)(d.TableFooter,{children:(0,t.jsxs)(d.TableRow,{children:[(0,t.jsx)(d.TableCell,{colSpan:5,className:"font-semibold",children:"Total"}),(0,t.jsxs)(d.TableCell,{className:"text-right font-mono font-semibold text-primary",children:[eT(12*P),(0,t.jsx)("span",{className:"ml-1 font-normal text-muted-foreground",children:"/yr"})]}),e&&(0,t.jsx)(d.TableCell,{})]})})]})})})]}),(0,t.jsx)(I,{open:j,onOpenChange:g,children:(0,t.jsxs)(en,{className:"sm:max-w-[480px]",children:[(0,t.jsxs)(er,{children:[(0,t.jsx)(ec,{children:b?"Edit Subscription":"Add Subscription"}),(0,t.jsx)(ed,{children:b?"Update the subscription details below.":"Enter the details for the new subscription."})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-4 py-2",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,t.jsx)(r.Label,{htmlFor:"sub-name",children:"Name"}),(0,t.jsx)(n.Input,{id:"sub-name",value:y.name,onChange:e=>v({...y,name:e.target.value}),placeholder:"e.g. Vercel Pro"})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,t.jsx)(r.Label,{htmlFor:"sub-category",children:"Category"}),(0,t.jsxs)(eo.Select,{value:y.category,onValueChange:e=>v({...y,category:e}),children:[(0,t.jsx)(eo.SelectTrigger,{id:"sub-category",children:(0,t.jsx)(eo.SelectValue,{})}),(0,t.jsx)(eo.SelectContent,{children:em.subscriptionCategories.map(e=>(0,t.jsx)(eo.SelectItem,{value:e,children:e},e))})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,t.jsx)(r.Label,{htmlFor:"sub-cycle",children:"Billing Cycle"}),(0,t.jsxs)(eo.Select,{value:y.billingCycle,onValueChange:e=>v({...y,billingCycle:e}),children:[(0,t.jsx)(eo.SelectTrigger,{id:"sub-cycle",children:(0,t.jsx)(eo.SelectValue,{})}),(0,t.jsxs)(eo.SelectContent,{children:[(0,t.jsx)(eo.SelectItem,{value:"monthly",children:"Monthly"}),(0,t.jsx)(eo.SelectItem,{value:"annual",children:"Annual"})]})]})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,t.jsxs)(r.Label,{htmlFor:"sub-amount",children:["Amount ($/","monthly"===y.billingCycle?"mo":"yr",")"]}),(0,t.jsx)(n.Input,{id:"sub-amount",type:"number",min:"0",step:"0.01",value:y.amount||"",onChange:e=>v({...y,amount:Number.parseFloat(e.target.value)||0}),placeholder:"0.00"})]})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,t.jsx)(r.Label,{htmlFor:"sub-renewal",children:"Renewal Date"}),(0,t.jsx)(n.Input,{id:"sub-renewal",type:"date",value:y.renewalDate,onChange:e=>v({...y,renewalDate:e.target.value})})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,t.jsx)(r.Label,{htmlFor:"sub-notes",children:"Notes"}),(0,t.jsx)(n.Input,{id:"sub-notes",value:y.notes,onChange:e=>v({...y,notes:e.target.value}),placeholder:"Optional notes"})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,t.jsx)(r.Label,{children:"Links"}),y.links.map((e,l)=>(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(n.Input,{placeholder:"Label",value:e.label,onChange:e=>{let t=[...y.links];t[l]={...t[l],label:e.target.value},v({...y,links:t})},className:"w-1/3"}),(0,t.jsx)(n.Input,{placeholder:"https://...",value:e.url,onChange:e=>{let t=[...y.links];t[l]={...t[l],url:e.target.value},v({...y,links:t})},className:"flex-1"}),(0,t.jsx)("button",{type:"button",className:"text-destructive hover:text-destructive/80",onClick:()=>v({...y,links:y.links.filter((e,t)=>t!==l)}),children:(0,t.jsx)(ea.X,{className:"h-3.5 w-3.5"})})]},l)),(0,t.jsxs)(s.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>v({...y,links:[...y.links,{url:"",label:""}]}),children:[(0,t.jsx)(ep,{className:"mr-1.5 h-3.5 w-3.5"})," Add Link"]})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,t.jsx)(r.Label,{children:"Receipts"}),(0,t.jsx)("input",{type:"file",accept:"image/*,.pdf,application/pdf",multiple:!0,className:"text-sm file:mr-3 file:rounded-md file:border-0 file:bg-primary file:px-3 file:py-1.5 file:text-sm file:font-medium file:text-primary-foreground hover:file:bg-primary/90",onChange:e=>{let t=Array.from(e.target.files??[]).filter(e=>!(e.size>5242880)||(f(`"${e.name}" exceeds 5 MB limit`),!1));w(e=>[...e,...t]),e.target.value=""}}),T.filter(e=>!S.some(t=>t.path===e.path)).map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-2 rounded-md border px-3 py-1.5 text-sm",children:[(0,t.jsx)(eg,{className:"h-3.5 w-3.5 shrink-0 text-muted-foreground"}),(0,t.jsx)("span",{className:"truncate",children:e.name}),(0,t.jsxs)("span",{className:"ml-auto text-muted-foreground",children:[(e.size/1024).toFixed(0)," KB"]}),(0,t.jsx)("button",{type:"button",className:"text-destructive hover:text-destructive/80",onClick:()=>D(t=>[...t,e]),children:(0,t.jsx)(ea.X,{className:"h-3.5 w-3.5"})})]},e.path)),C.map((e,l)=>(0,t.jsxs)("div",{className:"flex items-center gap-2 rounded-md border border-dashed px-3 py-1.5 text-sm",children:[(0,t.jsx)(eg,{className:"h-3.5 w-3.5 shrink-0 text-muted-foreground"}),(0,t.jsx)("span",{className:"truncate",children:e.name}),(0,t.jsxs)("span",{className:"ml-auto text-muted-foreground",children:[(e.size/1024).toFixed(0)," KB"]}),(0,t.jsx)("button",{type:"button",className:"text-destructive hover:text-destructive/80",onClick:()=>w(e=>e.filter((e,t)=>t!==l)),children:(0,t.jsx)(ea.X,{className:"h-3.5 w-3.5"})})]},`pending-${l}`))]})]}),(0,t.jsxs)(ei,{children:[(0,t.jsx)(s.Button,{variant:"outline",onClick:()=>g(!1),children:"Cancel"}),(0,t.jsx)(s.Button,{onClick:$,disabled:F||!y.name.trim(),children:F?"Uploading...":b?"Save Changes":"Add Subscription"})]})]})}),(0,t.jsx)(I,{open:null!==H,onOpenChange:()=>E(null),children:(0,t.jsxs)(en,{className:"sm:max-w-lg",children:[(0,t.jsxs)(er,{children:[(0,t.jsx)(ec,{children:"Receipts"}),(0,t.jsxs)(ed,{children:[H?.attachments?.length??0," receipt(s) attached to this subscription."]})]}),(0,t.jsx)("div",{className:"flex flex-col gap-4 max-h-[60vh] overflow-y-auto",children:H?.attachments?.map(e=>{let l=(0,ex.getAttachmentUrl)(o,e.path);return(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[e.name.toLowerCase().endsWith(".pdf")?(0,t.jsx)("iframe",{src:l,title:e.name,className:"w-full rounded-md border h-64"}):(0,t.jsx)("img",{src:l,alt:e.name,className:"w-full rounded-md border object-contain max-h-64"}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)("span",{className:"truncate font-medium",children:e.name}),(0,t.jsxs)("span",{className:"text-muted-foreground",children:[(e.size/1024).toFixed(0)," KB"]}),(0,t.jsxs)("a",{href:l,download:e.name,target:"_blank",rel:"noopener noreferrer",className:"ml-auto inline-flex items-center gap-1 text-primary hover:underline",children:[(0,t.jsx)(eb,{className:"h-3.5 w-3.5"}),"Download"]})]})]},e.path)})}),(0,t.jsx)(ei,{children:(0,t.jsx)(s.Button,{variant:"outline",onClick:()=>E(null),children:"Close"})})]})}),(0,t.jsx)(I,{open:null!==A,onOpenChange:()=>B(null),children:(0,t.jsxs)(en,{className:"sm:max-w-md",children:[(0,t.jsxs)(er,{children:[(0,t.jsx)(ec,{children:"Links"}),(0,t.jsxs)(ed,{children:[A?.links?.length??0," link(s)"]})]}),(0,t.jsx)("div",{className:"flex flex-col gap-2",children:A?.links?.map((e,l)=>(0,t.jsxs)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-sm text-primary hover:underline",children:[(0,t.jsx)(eN,{className:"h-3.5 w-3.5 shrink-0"}),e.label||e.url]},l))}),(0,t.jsx)(ei,{children:(0,t.jsx)(s.Button,{variant:"outline",onClick:()=>B(null),children:"Close"})})]})})]}):null}function eD(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(e)}function eF(){return new Date().toISOString().slice(0,10)}e.s(["SubscriptionsSection",()=>eS],31785);let eR={description:"",amount:0,date:eF(),notes:"",links:[]};function eI({editMode:e=!1,clientId:i="cygnet",hourlyRate:c=null,flatRate:o=null,onPayablesChange:m}){let{supabase:x}=(0,eu.useAuth)(),[u,h]=(0,l.useState)([]),[p,f]=(0,l.useState)(!1),[j,g]=(0,l.useState)(null),[b,N]=(0,l.useState)(!1),[y,v]=(0,l.useState)(null),[C,w]=(0,l.useState)(eR),[T,k]=(0,l.useState)(!1),[S,D]=(0,l.useState)([]),[F,R]=(0,l.useState)([]),[H,E]=(0,l.useState)([]),[A,B]=(0,l.useState)(null),[P,M]=(0,l.useState)(null),[L,$]=(0,l.useState)(0);(0,l.useEffect)(()=>{let e=!1;return f(!1),g(null),async function(){try{let t="nextier"===i,[l,a]=await Promise.all([(0,ex.fetchPayables)(x,i),t?Promise.resolve([]):(0,ex.fetchTimeEntries)(x,i)]);if(e)return;h(l);let s=a.reduce((e,t)=>e+t.totalHours,0),n=null!=o?o:null!=c?s*c:0;$(Math.round(.1*n*100)/100)}catch(t){e||g(t instanceof Error?t.message:"Failed to load payables")}finally{e||f(!0)}}(),()=>{e=!0}},[i,x,c,o]);let O=u.reduce((e,t)=>e+t.amount,0),U=(0,l.useCallback)(()=>{v(null),w({...eR,date:eF(),amount:L,description:L>0?"10% of time entries":"",links:[]}),D([]),R([]),E([]),N(!0)},[L]),z=(0,l.useCallback)(e=>{v(e.id),w({description:e.description,amount:e.amount,date:e.date,notes:e.notes,links:e.links??[]}),D([]),R(e.attachments??[]),E([]),N(!0)},[]),_=(0,l.useCallback)(async()=>{if(!C.description.trim())return;let e=y??crypto.randomUUID();try{for(let e of(k(!0),H))await (0,ex.deleteAttachment)(x,e.path);let t=[];for(let l of S){let a=await (0,ex.uploadAttachment)(x,l,i,e);t.push(a)}let l=[...F.filter(e=>!H.some(t=>t.path===e.path)),...t];if(y){let e=u.find(e=>e.id===y),t={id:y,description:C.description,amount:C.amount,date:C.date,paid:e?.paid??!1,paidDate:e?.paidDate??"",notes:C.notes,attachments:l,links:C.links};h(e=>e.map(e=>e.id===y?t:e)),await (0,ex.upsertPayable)(x,t,i),"nextier"!==i&&e&&await (0,ex.updateNextierMirror)(x,e.description,e.amount,e.date,{description:t.description,amount:t.amount,date:t.date,notes:t.notes,attachments:l,links:C.links})}else{let t={id:e,description:C.description,amount:C.amount,date:C.date,paid:!1,paidDate:"",notes:C.notes,attachments:l,links:C.links};if(h(e=>[t,...e]),await (0,ex.upsertPayable)(x,t,i),"nextier"!==i){let e={id:crypto.randomUUID(),description:C.description,amount:C.amount,date:C.date,paid:!0,paidDate:eF(),notes:C.notes,attachments:l,links:C.links};await (0,ex.upsertPayable)(x,e,"nextier")}}N(!1),m?.()}catch(e){g(e instanceof Error?e.message:"Failed to save payable");try{let e=await (0,ex.fetchPayables)(x,i);h(e)}catch{}}finally{k(!1)}},[y,C,i,x,u,S,F,H]),V=(0,l.useCallback)(async e=>{let t=u.find(t=>t.id===e);h(t=>t.filter(t=>t.id!==e));try{t?.attachments?.length&&await (0,ex.deleteAllAttachments)(x,t.attachments),await (0,ex.deletePayable)(x,e),"nextier"!==i&&t&&await (0,ex.deletePayableByMatch)(x,"nextier",t.description,t.amount,t.date),m?.()}catch(e){g(e instanceof Error?e.message:"Failed to delete payable"),h(u)}},[u,x]);return p&&(0!==u.length||e||"nextier"===i)?(0,t.jsxs)("div",{className:"flex flex-col gap-6",children:[j&&(0,t.jsx)(a.Card,{className:"border-destructive",children:(0,t.jsxs)(a.CardContent,{className:"p-4 text-destructive",children:[j,(0,t.jsx)(s.Button,{variant:"ghost",size:"sm",className:"ml-2",onClick:()=>g(null),children:"Dismiss"})]})}),(0,t.jsxs)(a.Card,{children:[(0,t.jsxs)(a.CardHeader,{className:"flex flex-row items-center justify-between pb-4",children:[(0,t.jsx)("div",{children:(0,t.jsx)(a.CardTitle,{children:"nextier"===i?"Nextier Proceeds":"Payables"})}),e&&"nextier"!==i&&(0,t.jsxs)(s.Button,{size:"sm",onClick:U,className:"gap-1.5",children:[(0,t.jsx)(ep,{className:"h-4 w-4"}),"Add Payable"]})]}),u.length>0&&(0,t.jsx)(a.CardContent,{className:"p-0",children:(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)(d.Table,{children:[(0,t.jsx)(d.TableHeader,{children:(0,t.jsxs)(d.TableRow,{children:[(0,t.jsx)(d.TableHead,{className:"w-[110px]",children:"Date"}),(0,t.jsx)(d.TableHead,{children:"Description"}),(0,t.jsx)(d.TableHead,{children:"Notes"}),(0,t.jsx)(d.TableHead,{className:"w-[100px] text-right",children:"Amount"}),e&&"nextier"!==i&&(0,t.jsx)(d.TableHead,{className:"w-[100px] text-right",children:"Actions"})]})}),(0,t.jsx)(d.TableBody,{children:u.map(l=>{let a;return(0,t.jsxs)(d.TableRow,{children:[(0,t.jsx)(d.TableCell,{className:"text-muted-foreground",children:l.date?(a=new Date(l.date+"T00:00:00"),`${String(a.getMonth()+1).padStart(2,"0")}/${String(a.getDate()).padStart(2,"0")}/${a.getFullYear()}`):"—"}),(0,t.jsx)(d.TableCell,{className:"font-medium",children:l.description}),(0,t.jsx)(d.TableCell,{className:"max-w-[160px] text-muted-foreground",children:l.notes||"—"}),(0,t.jsx)(d.TableCell,{className:"text-right font-mono",children:(0,t.jsxs)("span",{className:"inline-flex items-center gap-1.5",children:[eD(l.amount),l.attachments?.length>0&&(0,t.jsx)("button",{type:"button",className:"inline-flex text-muted-foreground hover:text-primary",title:`${l.attachments.length} file(s)`,onClick:()=>B(l),children:(0,t.jsx)(eg,{className:"h-3.5 w-3.5"})}),l.links?.length>0&&(0,t.jsx)("button",{type:"button",className:"inline-flex text-muted-foreground hover:text-primary",title:`${l.links.length} link(s)`,onClick:()=>M(l),children:(0,t.jsx)(eN,{className:"h-3.5 w-3.5"})})]})}),e&&"nextier"!==i&&(0,t.jsx)(d.TableCell,{className:"text-right",children:(0,t.jsxs)("div",{className:"flex items-center justify-end gap-1",children:[(0,t.jsxs)(s.Button,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>z(l),children:[(0,t.jsx)(ef,{className:"h-3.5 w-3.5"}),(0,t.jsx)("span",{className:"sr-only",children:"Edit"})]}),(0,t.jsxs)(s.Button,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive hover:text-destructive",onClick:()=>V(l.id),children:[(0,t.jsx)(ej,{className:"h-3.5 w-3.5"}),(0,t.jsx)("span",{className:"sr-only",children:"Delete"})]})]})})]},l.id)})}),(0,t.jsx)(d.TableFooter,{children:(0,t.jsxs)(d.TableRow,{children:[(0,t.jsx)(d.TableCell,{colSpan:3,className:"font-semibold",children:"Total"}),(0,t.jsx)(d.TableCell,{className:"text-right font-mono font-semibold text-primary",children:eD(O)}),e&&"nextier"!==i&&(0,t.jsx)(d.TableCell,{})]})})]})})})]}),(0,t.jsx)(I,{open:null!==A,onOpenChange:()=>B(null),children:(0,t.jsxs)(en,{className:"sm:max-w-lg",children:[(0,t.jsxs)(er,{children:[(0,t.jsx)(ec,{children:"Attachments"}),(0,t.jsxs)(ed,{children:[A?.attachments?.length??0," file(s) attached to this payable."]})]}),(0,t.jsx)("div",{className:"flex flex-col gap-4 max-h-[60vh] overflow-y-auto",children:A?.attachments?.map(e=>{let l=(0,ex.getAttachmentUrl)(x,e.path);return(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[e.name.toLowerCase().endsWith(".pdf")?(0,t.jsx)("iframe",{src:l,title:e.name,className:"w-full rounded-md border h-64"}):(0,t.jsx)("img",{src:l,alt:e.name,className:"w-full rounded-md border object-contain max-h-64"}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)("span",{className:"truncate font-medium",children:e.name}),(0,t.jsxs)("span",{className:"text-muted-foreground",children:[(e.size/1024).toFixed(0)," KB"]}),(0,t.jsxs)("a",{href:l,download:e.name,target:"_blank",rel:"noopener noreferrer",className:"ml-auto inline-flex items-center gap-1 text-primary hover:underline",children:[(0,t.jsx)(eb,{className:"h-3.5 w-3.5"}),"Download"]})]})]},e.path)})}),(0,t.jsx)(ei,{children:(0,t.jsx)(s.Button,{variant:"outline",onClick:()=>B(null),children:"Close"})})]})}),(0,t.jsx)(I,{open:null!==P,onOpenChange:()=>M(null),children:(0,t.jsxs)(en,{className:"sm:max-w-md",children:[(0,t.jsxs)(er,{children:[(0,t.jsx)(ec,{children:"Links"}),(0,t.jsxs)(ed,{children:[P?.links?.length??0," link(s)"]})]}),(0,t.jsx)("div",{className:"flex flex-col gap-2",children:P?.links?.map((e,l)=>(0,t.jsxs)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-sm text-primary hover:underline",children:[(0,t.jsx)(eN,{className:"h-3.5 w-3.5 shrink-0"}),e.label||e.url]},l))}),(0,t.jsx)(ei,{children:(0,t.jsx)(s.Button,{variant:"outline",onClick:()=>M(null),children:"Close"})})]})}),(0,t.jsx)(I,{open:b,onOpenChange:N,children:(0,t.jsxs)(en,{className:"sm:max-w-[480px]",children:[(0,t.jsxs)(er,{children:[(0,t.jsx)(ec,{children:y?"Edit Payable":"Add Payable"}),(0,t.jsx)(ed,{children:y?"Update the payable details below.":"Enter the details for the new payable."})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-4 py-2",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,t.jsx)(r.Label,{htmlFor:"pay-desc",children:"Description"}),(0,t.jsx)(n.Input,{id:"pay-desc",value:C.description,onChange:e=>w({...C,description:e.target.value}),placeholder:"e.g. Website development - Phase 1"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,t.jsx)(r.Label,{htmlFor:"pay-amount",children:"Amount ($)"}),(0,t.jsx)(n.Input,{id:"pay-amount",type:"number",min:"0",step:"0.01",value:C.amount||"",onChange:e=>w({...C,amount:Number.parseFloat(e.target.value)||0}),placeholder:"0.00"})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,t.jsx)(r.Label,{htmlFor:"pay-date",children:"Date"}),(0,t.jsx)(n.Input,{id:"pay-date",type:"date",value:C.date,onChange:e=>w({...C,date:e.target.value})})]})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,t.jsx)(r.Label,{htmlFor:"pay-notes",children:"Notes"}),(0,t.jsx)(n.Input,{id:"pay-notes",value:C.notes,onChange:e=>w({...C,notes:e.target.value}),placeholder:"Optional notes"})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,t.jsx)(r.Label,{children:"Links"}),C.links.map((e,l)=>(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(n.Input,{placeholder:"Label",value:e.label,onChange:e=>{let t=[...C.links];t[l]={...t[l],label:e.target.value},w({...C,links:t})},className:"w-1/3"}),(0,t.jsx)(n.Input,{placeholder:"https://...",value:e.url,onChange:e=>{let t=[...C.links];t[l]={...t[l],url:e.target.value},w({...C,links:t})},className:"flex-1"}),(0,t.jsx)("button",{type:"button",className:"text-destructive hover:text-destructive/80",onClick:()=>w({...C,links:C.links.filter((e,t)=>t!==l)}),children:(0,t.jsx)(ea.X,{className:"h-3.5 w-3.5"})})]},l)),(0,t.jsxs)(s.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>w({...C,links:[...C.links,{url:"",label:""}]}),children:[(0,t.jsx)(ep,{className:"mr-1.5 h-3.5 w-3.5"})," Add Link"]})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,t.jsx)(r.Label,{children:"Attachments"}),(0,t.jsx)("input",{type:"file",accept:"image/*,.pdf,application/pdf",multiple:!0,className:"text-sm file:mr-3 file:rounded-md file:border-0 file:bg-primary file:px-3 file:py-1.5 file:text-sm file:font-medium file:text-primary-foreground hover:file:bg-primary/90",onChange:e=>{let t=Array.from(e.target.files??[]).filter(e=>!(e.size>5242880)||(g(`"${e.name}" exceeds 5 MB limit`),!1));D(e=>[...e,...t]),e.target.value=""}}),F.filter(e=>!H.some(t=>t.path===e.path)).map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-2 rounded-md border px-3 py-1.5 text-sm",children:[(0,t.jsx)(eg,{className:"h-3.5 w-3.5 shrink-0 text-muted-foreground"}),(0,t.jsx)("span",{className:"truncate",children:e.name}),(0,t.jsxs)("span",{className:"ml-auto text-muted-foreground",children:[(e.size/1024).toFixed(0)," KB"]}),(0,t.jsx)("button",{type:"button",className:"text-destructive hover:text-destructive/80",onClick:()=>E(t=>[...t,e]),children:(0,t.jsx)(ea.X,{className:"h-3.5 w-3.5"})})]},e.path)),S.map((e,l)=>(0,t.jsxs)("div",{className:"flex items-center gap-2 rounded-md border border-dashed px-3 py-1.5 text-sm",children:[(0,t.jsx)(eg,{className:"h-3.5 w-3.5 shrink-0 text-muted-foreground"}),(0,t.jsx)("span",{className:"truncate",children:e.name}),(0,t.jsxs)("span",{className:"ml-auto text-muted-foreground",children:[(e.size/1024).toFixed(0)," KB"]}),(0,t.jsx)("button",{type:"button",className:"text-destructive hover:text-destructive/80",onClick:()=>D(e=>e.filter((e,t)=>t!==l)),children:(0,t.jsx)(ea.X,{className:"h-3.5 w-3.5"})})]},`pending-${l}`))]})]}),(0,t.jsxs)(ei,{children:[(0,t.jsx)(s.Button,{variant:"outline",onClick:()=>N(!1),children:"Cancel"}),(0,t.jsx)(s.Button,{onClick:_,disabled:T||!C.description.trim(),children:T?"Saving...":y?"Save Changes":"Add Payable"})]})]})})]}):null}function eH(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(e)}function eE({clientId:e="cygnet",hourlyRate:s=null,flatRate:n=null,refreshKey:r=0,hidePayables:i=!1}){let{supabase:c}=(0,eu.useAuth)(),[d,o]=(0,l.useState)(0),[m,x]=(0,l.useState)(0),[u,h]=(0,l.useState)(0),[p,f]=(0,l.useState)(!1);if((0,l.useEffect)(()=>{let t=!1;return f(!1),async function(){try{let[l,a,r]=await Promise.all([(0,ex.fetchTimeEntries)(c,e),(0,ex.fetchSubscriptions)(c,e),(0,ex.fetchPayables)(c,e)]);if(t)return;let i=0===l.length&&0===a.length&&0===r.length,d=l.reduce((e,t)=>e+t.totalHours,0);o(i?null:null!=n?n:null!=s?d*s:null);let m=a.reduce((e,t)=>"monthly"===t.billingCycle?e+t.amount:e+t.amount/12,0);x(m);let u=r.reduce((e,t)=>e+t.amount,0);h(u)}catch{}finally{t||f(!0)}}(),()=>{t=!0}},[e,c,r]),!p||!(null!==d||m>0||u>0))return null;let j=12*m,g=i?0:u,b=null!=d?d+j:null,N="nextier"===e?g:null!=b?b-g:null;return(0,t.jsxs)(a.Card,{className:"ml-auto sm:max-w-[50%]",children:[(0,t.jsx)(a.CardHeader,{children:(0,t.jsx)(a.CardTitle,{children:"Grand Total"})}),(0,t.jsx)(a.CardContent,{children:(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsxs)("div",{className:"flex flex-col items-end",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-0.5 items-end text-muted-foreground",children:[(null==d||d>0)&&(0,t.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,t.jsx)("span",{children:"Time Tracking"}),(0,t.jsx)("span",{className:"font-mono",children:null!=d?eH(d):"TBD"})]}),j>0&&(0,t.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,t.jsx)("span",{children:"Subscriptions"}),(0,t.jsx)("span",{className:"font-mono",children:eH(j)})]}),!i&&u>0&&(0,t.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,t.jsx)("span",{children:"nextier"===e?"Proceeds":"Payables"}),(0,t.jsxs)("span",{className:"font-mono",children:["nextier"===e?"":"−",eH(u)]})]})]}),(0,t.jsx)("div",{className:"mt-1 border-t border-border pt-1 w-full text-right",children:(0,t.jsx)("span",{className:"font-mono font-bold text-primary",children:null!=N?eH(N):"TBD"})})]})})})]})}e.s(["PayablesSection",()=>eI],36441),e.s(["GrandTotalSection",()=>eE],79173)},57505,e=>{"use strict";var t=e.i(43476),l=e.i(71645),a=e.i(70065),s=e.i(67881),n=e.i(23750),r=e.i(10708),i=e.i(30374),c=e.i(47627),d=e.i(88699),o=e.i(78917),m=e.i(17927),x=e.i(91432);function u(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(e)}function h({invoice:e,onInvoiceUpdate:h}){let{supabase:p}=(0,x.useAuth)(),[f,j]=(0,l.useState)([]),[g,b]=(0,l.useState)([]),[N,y]=(0,l.useState)([]),[v,C]=(0,l.useState)(!1),[w,T]=(0,l.useState)(!1),[k,S]=(0,l.useState)([]),[D,F]=(0,l.useState)(!1),[R,I]=(0,l.useState)(""),[H,E]=(0,l.useState)(""),[A,B]=(0,l.useState)(!1);if((0,l.useEffect)(()=>{let t=!1;return async function(){try{let[l,a,s]=await Promise.all([(0,m.fetchTimeEntriesByInvoice)(p,e.id),(0,m.fetchSubscriptionsByInvoice)(p,e.id),(0,m.fetchPayablesByInvoice)(p,e.id)]);if(t)return;j(l),b(a),y(s)}catch{}finally{t||C(!0)}}(),()=>{t=!0}},[e.id,p]),!v)return(0,t.jsx)(a.Card,{children:(0,t.jsx)(a.CardContent,{className:"p-8 text-center text-muted-foreground",children:"Loading archived invoice..."})});let P=f.reduce((e,t)=>e+t.totalHours,0);function M(e){let t=new Date(e+"T00:00:00");return`${String(t.getMonth()+1).padStart(2,"0")}/${String(t.getDate()).padStart(2,"0")}/${t.getFullYear()}`}let L=e.periodStart&&e.periodEnd?`${M(e.periodStart)} - ${M(e.periodEnd)}`:"N/A";return(0,t.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,t.jsxs)(a.Card,{children:[(0,t.jsx)(a.CardHeader,{children:(0,t.jsx)(a.CardTitle,{children:e.invoiceNumber})}),(0,t.jsxs)(a.CardContent,{children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4 sm:grid-cols-5 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Period"}),(0,t.jsx)("p",{className:"font-medium",children:L})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Hourly Rate"}),(0,t.jsx)("p",{className:"font-mono font-medium",children:P>0?`${u(e.totalTime/P)}/hr`:"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Time"}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("p",{className:"font-mono font-medium",children:u(e.totalTime)}),h&&(0,t.jsx)("button",{className:"text-muted-foreground hover:text-primary",onClick:()=>{I(""),E(""),T(!0)},"aria-label":"Edit rate",children:(0,t.jsx)(d.Pencil,{className:"h-3.5 w-3.5"})})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Subscriptions"}),(0,t.jsx)("p",{className:"font-mono font-medium",children:u(e.totalSubscriptions)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Payables"}),(0,t.jsx)("p",{className:"font-mono font-medium",children:u(e.totalPayables)})]})]}),e.notes&&(0,t.jsx)("p",{className:"mt-3 text-sm text-muted-foreground",children:e.notes})]})]}),f.length>0&&(0,t.jsxs)(a.Card,{children:[(0,t.jsx)(a.CardHeader,{children:(0,t.jsx)(a.CardTitle,{children:"Time Tracking"})}),(0,t.jsx)(a.CardContent,{className:"p-0",children:(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)(c.Table,{children:[(0,t.jsx)(c.TableHeader,{children:(0,t.jsxs)(c.TableRow,{children:[(0,t.jsx)(c.TableHead,{className:"w-[110px]",children:"Date"}),(0,t.jsx)(c.TableHead,{children:"Tasks"}),(0,t.jsx)(c.TableHead,{children:"Notes"}),(0,t.jsx)(c.TableHead,{children:"Time Range"}),(0,t.jsx)(c.TableHead,{className:"w-[80px] text-right",children:"Hours"})]})}),(0,t.jsx)(c.TableBody,{children:f.map(e=>(0,t.jsxs)(c.TableRow,{children:[(0,t.jsx)(c.TableCell,{className:"whitespace-nowrap font-medium",children:M(e.date)}),(0,t.jsx)(c.TableCell,{className:"max-w-[220px] text-muted-foreground",children:e.tasks}),(0,t.jsx)(c.TableCell,{className:"max-w-[160px] text-muted-foreground",children:e.notes||"—"}),(0,t.jsx)(c.TableCell,{className:"whitespace-nowrap",children:e.timeRange}),(0,t.jsx)(c.TableCell,{className:"text-right font-mono",children:(0,t.jsxs)("span",{className:"inline-flex items-center gap-1",children:[e.totalHours.toFixed(2),e.links&&e.links.length>0&&(0,t.jsx)("button",{className:"text-muted-foreground hover:text-primary",onClick:()=>{S(e.links),F(!0)},"aria-label":"View links",children:(0,t.jsx)(o.ExternalLink,{className:"h-3.5 w-3.5"})})]})})]},e.id))}),(0,t.jsx)(c.TableFooter,{children:(0,t.jsxs)(c.TableRow,{children:[(0,t.jsx)(c.TableCell,{colSpan:4,className:"font-semibold",children:"Total"}),(0,t.jsx)(c.TableCell,{className:"text-right font-mono font-semibold",children:f.reduce((e,t)=>e+t.totalHours,0).toFixed(2)})]})})]})})})]}),g.length>0&&(0,t.jsxs)(a.Card,{children:[(0,t.jsx)(a.CardHeader,{children:(0,t.jsx)(a.CardTitle,{children:"Software Subscriptions"})}),(0,t.jsx)(a.CardContent,{className:"p-0",children:(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)(c.Table,{children:[(0,t.jsx)(c.TableHeader,{children:(0,t.jsxs)(c.TableRow,{children:[(0,t.jsx)(c.TableHead,{children:"Name"}),(0,t.jsx)(c.TableHead,{children:"Category"}),(0,t.jsx)(c.TableHead,{className:"w-[110px]",children:"Billing Cycle"}),(0,t.jsx)(c.TableHead,{className:"w-[110px]",children:"Renewal Date"}),(0,t.jsx)(c.TableHead,{children:"Notes"}),(0,t.jsx)(c.TableHead,{className:"w-[100px] text-right",children:"Amount"})]})}),(0,t.jsx)(c.TableBody,{children:g.map(e=>(0,t.jsxs)(c.TableRow,{children:[(0,t.jsx)(c.TableCell,{className:"font-medium",children:e.name}),(0,t.jsx)(c.TableCell,{className:"text-muted-foreground",children:e.category}),(0,t.jsx)(c.TableCell,{className:"capitalize",children:e.billingCycle}),(0,t.jsx)(c.TableCell,{className:"text-muted-foreground",children:e.renewalDate?M(e.renewalDate):"—"}),(0,t.jsx)(c.TableCell,{className:"max-w-[160px] text-muted-foreground",children:e.notes||"—"}),(0,t.jsx)(c.TableCell,{className:"text-right font-mono",children:(0,t.jsxs)("span",{className:"inline-flex items-center gap-1",children:[u(e.amount),(0,t.jsxs)("span",{className:"text-muted-foreground",children:["/","monthly"===e.billingCycle?"mo":"yr"]}),e.links&&e.links.length>0&&(0,t.jsx)("button",{className:"text-muted-foreground hover:text-primary",onClick:()=>{S(e.links),F(!0)},"aria-label":"View links",children:(0,t.jsx)(o.ExternalLink,{className:"h-3.5 w-3.5"})})]})})]},e.id))})]})})})]}),N.length>0&&(0,t.jsxs)(a.Card,{children:[(0,t.jsx)(a.CardHeader,{children:(0,t.jsx)(a.CardTitle,{children:"nextier"===e.clientId?"Nextier Proceeds":"Payables"})}),(0,t.jsx)(a.CardContent,{className:"p-0",children:(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)(c.Table,{children:[(0,t.jsx)(c.TableHeader,{children:(0,t.jsxs)(c.TableRow,{children:[(0,t.jsx)(c.TableHead,{className:"w-[110px]",children:"Date"}),(0,t.jsx)(c.TableHead,{children:"Description"}),(0,t.jsx)(c.TableHead,{className:"w-[100px] text-right",children:"Amount"}),(0,t.jsx)(c.TableHead,{children:"Notes"})]})}),(0,t.jsx)(c.TableBody,{children:N.map(e=>(0,t.jsxs)(c.TableRow,{children:[(0,t.jsx)(c.TableCell,{className:"text-muted-foreground",children:e.date?M(e.date):"—"}),(0,t.jsx)(c.TableCell,{className:"font-medium",children:e.description}),(0,t.jsx)(c.TableCell,{className:"text-right font-mono",children:(0,t.jsxs)("span",{className:"inline-flex items-center gap-1",children:[u(e.amount),e.links&&e.links.length>0&&(0,t.jsx)("button",{className:"text-muted-foreground hover:text-primary",onClick:()=>{S(e.links),F(!0)},"aria-label":"View links",children:(0,t.jsx)(o.ExternalLink,{className:"h-3.5 w-3.5"})})]})}),(0,t.jsx)(c.TableCell,{className:"max-w-[160px] text-muted-foreground",children:e.notes||"—"})]},e.id))}),(0,t.jsx)(c.TableFooter,{children:(0,t.jsxs)(c.TableRow,{children:[(0,t.jsx)(c.TableCell,{colSpan:2,className:"font-semibold",children:"Total"}),(0,t.jsx)(c.TableCell,{className:"text-right font-mono font-semibold text-primary",children:u(N.reduce((e,t)=>e+t.amount,0))}),(0,t.jsx)(c.TableCell,{})]})})]})})})]}),(0,t.jsxs)(a.Card,{className:"ml-auto sm:max-w-[50%]",children:[(0,t.jsx)(a.CardHeader,{children:(0,t.jsx)(a.CardTitle,{children:"Grand Total"})}),(0,t.jsx)(a.CardContent,{children:(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsxs)("div",{className:"flex flex-col items-end",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-0.5 items-end text-muted-foreground",children:[(e.totalTime>0||0===e.totalTime)&&f.length>0&&(0,t.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,t.jsx)("span",{children:"Time Tracking"}),(0,t.jsx)("span",{className:"font-mono",children:u(e.totalTime)})]}),e.totalSubscriptions>0&&(0,t.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,t.jsx)("span",{children:"Subscriptions"}),(0,t.jsx)("span",{className:"font-mono",children:u(e.totalSubscriptions)})]}),e.totalPayables>0&&(0,t.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,t.jsx)("span",{children:"nextier"===e.clientId?"Proceeds":"Payables"}),(0,t.jsxs)("span",{className:"font-mono",children:["nextier"===e.clientId?"":"−",u(e.totalPayables)]})]})]}),(0,t.jsx)("div",{className:"mt-1 border-t border-border pt-1 w-full text-right",children:(0,t.jsx)("span",{className:"font-mono font-bold text-primary",children:u(e.grandTotal)})})]})})})]}),(0,t.jsx)(i.Dialog,{open:D,onOpenChange:F,children:(0,t.jsxs)(i.DialogContent,{className:"sm:max-w-md",children:[(0,t.jsxs)(i.DialogHeader,{children:[(0,t.jsx)(i.DialogTitle,{children:"Links"}),(0,t.jsxs)(i.DialogDescription,{children:[k.length," link(s)"]})]}),(0,t.jsx)("div",{className:"flex flex-col gap-2",children:k.map((e,l)=>(0,t.jsxs)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-sm text-primary hover:underline",children:[(0,t.jsx)(o.ExternalLink,{className:"h-3.5 w-3.5 shrink-0"}),e.label||e.url]},l))}),(0,t.jsx)(i.DialogFooter,{children:(0,t.jsx)(s.Button,{variant:"outline",onClick:()=>F(!1),children:"Close"})})]})}),h&&(0,t.jsx)(i.Dialog,{open:w,onOpenChange:T,children:(0,t.jsxs)(i.DialogContent,{className:"sm:max-w-sm",children:[(0,t.jsxs)(i.DialogHeader,{children:[(0,t.jsx)(i.DialogTitle,{children:"Update Rate"}),(0,t.jsxs)(i.DialogDescription,{children:["Set an hourly rate or flat rate to recalculate the time cost for this invoice. Total hours: ",P.toFixed(2)]})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,t.jsx)(r.Label,{htmlFor:"rate-hourly",children:"Hourly Rate"}),(0,t.jsx)(n.Input,{id:"rate-hourly",type:"number",placeholder:"e.g. 75",min:"0",step:"0.01",value:R,onChange:e=>I(e.target.value),disabled:!!H.trim()})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1.5",children:[(0,t.jsx)(r.Label,{htmlFor:"rate-flat",children:"Flat Rate"}),(0,t.jsx)(n.Input,{id:"rate-flat",type:"number",placeholder:"e.g. 5000",min:"0",step:"0.01",value:H,onChange:e=>E(e.target.value),disabled:!!R.trim()})]})]}),(R.trim()||H.trim())&&(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["New time cost: ",u(H.trim()?Number(H):P*Number(R))]})]}),(0,t.jsxs)(i.DialogFooter,{children:[(0,t.jsx)(s.Button,{variant:"outline",onClick:()=>T(!1),children:"Cancel"}),(0,t.jsx)(s.Button,{disabled:A||!R.trim()&&!H.trim(),onClick:async()=>{B(!0);try{let t=H.trim()?Math.round(100*Number(H))/100:Math.round(P*Number(R)*100)/100,l="nextier"===e.clientId?e.totalPayables:Math.round((t+e.totalSubscriptions-e.totalPayables)*100)/100,a=await (0,m.updateInvoice)(p,e.id,{total_time:t,grand_total:l});h(a),T(!1)}catch{}finally{B(!1)}},children:A?"Saving...":"Update Rate"})]})]})})]})}e.s(["ArchivedInvoiceView",()=>h])},51804,e=>{"use strict";let t=(0,e.i(75254).default)("calendar-check",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]);e.s(["CalendarCheck",()=>t],51804)}]);